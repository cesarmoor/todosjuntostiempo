<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todos juntos al mismo tiempo - Conecta con la Embriolog√≠a</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .app-container {
            width: 100%;
            max-width: 400px;
            height: 90vh;
            max-height: 800px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            overflow: hidden;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b 0%, #ff8e8e 100%);
            color: white;
            padding: 15px 20px;
            text-align: center;
            flex-shrink: 0;
        }

        .header h1 {
            font-size: 24px;
            font-weight: bold;
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            flex-shrink: 0;
        }

        .nav-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            background: transparent;
            font-size: 14px;
            color: #666;
        }

        .nav-tab.active {
            background: white;
            color: #ff6b6b;
            border-bottom: 3px solid #ff6b6b;
            font-weight: 600;
        }

        .content {
            flex: 1;
            position: relative;
            overflow: hidden;
            background: #fafafa;
        }

        .tab-content {
            display: none;
            height: 100%;
            position: relative;
        }

        .tab-content.active {
            display: block;
        }

        /* Secci√≥n de deslizamiento */
        .swipe-container {
            position: relative;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            padding-bottom: 80px; /* Espacio para los botones de acci√≥n */
        }

        .cards-stack {
            position: relative;
            width: 100%;
            max-width: 350px;
            height: 480px;
        }

        .card {
            width: 100%;
            height: 100%;
            position: absolute;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            cursor: grab;
            overflow: hidden;
            transform-origin: center bottom;
        }

        .card.dragging {
            cursor: grabbing;
            transition: none !important;
        }

        .card img {
            width: 100%;
            height: 55%;
            object-fit: cover;
            background: #e0e0e0;
        }

        .card-info {
            padding: 15px;
            height: 45%;
            overflow-y: auto; 
        }

        .card-info h3 {
            font-size: 18px;
            margin-bottom: 8px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .profile-badge {
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
            text-transform: uppercase;
            white-space: nowrap;
        }

        .badge-estructura {
            background: #42dca3;
            color: white;
        }
        .badge-proceso {
            background: #5dade2; 
            color: white;
        }
        .badge-patologia {
            background: #ff4458;
            color: white;
        }


        .card-info p {
            color: #666;
            line-height: 1.4;
            font-size: 13px;
            margin-bottom: 10px;
        }

        .card-stats {
            display: flex;
            gap: 15px;
            font-size: 11px;
            color: #999;
            margin-top: auto; 
        }

        .action-buttons {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
            z-index: 10;
        }

        .action-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.3s;
            background: white;
        }

        .reject-btn {
            border-color: #ff4458;
            color: #ff4458;
        }

        .reject-btn:hover {
            background: #ff4458;
            color: white;
            transform: scale(1.1);
        }

        .like-btn {
            border-color: #42dca3;
            color: #42dca3;
        }

        .like-btn:hover {
            background: #42dca3;
            color: white;
            transform: scale(1.1);
        }

        .super-like-btn {
            width: 40px;
            height: 40px;
            border-color: #3498db;
            color: #3498db;
            font-size: 16px;
        }

        .super-like-btn:hover {
            background: #3498db;
            color: white;
            transform: scale(1.1);
        }

        /* Animaciones */
        .swipe-right {
            animation: swipeRight 0.5s ease-out forwards;
        }

        .swipe-left {
            animation: swipeLeft 0.5s ease-out forwards;
        }

        .super-like-animation {
            animation: superLike 0.5s ease-out forwards;
        }

        @keyframes swipeRight {
            to {
                transform: translateX(150%) rotate(30deg) !important; 
                opacity: 0;
            }
        }

        @keyframes swipeLeft {
            to {
                transform: translateX(-150%) rotate(-30deg) !important;
                opacity: 0;
            }
        }

        @keyframes superLike {
            to {
                transform: translateY(-150%) scale(0.5) !important;
                opacity: 0;
            }
        }

        /* Secci√≥n de matches */
        .matches-container {
            padding: 20px;
            height: 100%;
            overflow-y: auto;
        }

        .matches-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); 
            gap: 15px;
        }

        .match-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s;
            display: flex;
            flex-direction: column;
        }

        .match-card:hover {
            transform: translateY(-5px);
        }

        .match-card img {
            width: 100%;
            height: 100px;
            object-fit: cover;
        }

        .match-info {
            padding: 10px;
            flex-grow: 1; 
        }

        .match-info h4 {
            font-size: 14px;
            margin-bottom: 5px;
            color: #333;
        }

        .match-info p {
            font-size: 11px;
            color: #666;
        }

        /* Secci√≥n de chat */
        .chat-container {
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .chat-header {
            padding: 15px;
            background: linear-gradient(135deg, #ff6b6b 0%, #ff8e8e 100%);
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
            flex-shrink: 0;
        }

        .chat-header img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .chat-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
            background: #f8f9fa;
        }

        .message {
            max-width: 75%; 
            padding: 10px 15px;
            border-radius: 18px;
            word-wrap: break-word;
            line-height: 1.4;
        }

        .message.user {
            background: #ff6b6b;
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 5px;
        }

        .message.ai {
            background: white;
            color: #333;
            align-self: flex-start;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border-bottom-left-radius: 5px;
        }
        
        .typing-indicator {
            display: flex; 
            align-items: center;
            padding: 10px 15px;
            border-radius: 18px;
            background: white;
            color: #333;
            align-self: flex-start;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            margin: 5px 0;
            border-bottom-left-radius: 5px;
        }

        .typing-indicator span {
            height: 8px;
            width: 8px;
            background-color: #aaa;
            border-radius: 50%;
            display: inline-block;
            margin: 0 2px;
            animation: typing-bounce 1.4s infinite ease-in-out both;
        }

        .typing-indicator span:nth-child(1) {
            animation-delay: -0.32s;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: -0.16s;
        }

        @keyframes typing-bounce {
            0%, 80%, 100% {
                transform: scale(0);
            } 40% {
                transform: scale(1.0);
            }
        }


        .chat-input {
            padding: 15px;
            border-top: 1px solid #e9ecef;
            display: flex;
            gap: 10px;
            background: white;
            flex-shrink: 0;
        }

        .chat-input input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 20px;
            outline: none;
            font-size: 14px;
        }

        .send-btn {
            padding: 10px 20px;
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
        }

        .empty-state {
            text-align: center;
            color: #666;
            padding: 40px 20px;
            display: flex; 
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%; 
        }

        .empty-state h3 {
            margin-bottom: 10px;
            color: #333;
        }

        /* Match popup */
        .match-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .match-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            max-width: 300px;
            margin: 20px;
        }

        .match-content h2 {
            color: #ff6b6b;
            margin-bottom: 15px;
            font-size: 24px;
        }

        .match-content p {
            margin-bottom: 20px;
            color: #666;
        }

        .match-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
        }

        /* Responsive */
        @media (max-width: 480px) {
            body {
                padding: 0;
            }
            
            .app-container {
                border-radius: 0;
                height: 100vh;
                max-height: none;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <h1>üß¨üë∂ Todos juntos al mismo tiempo</h1>
        </div>
        
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('swipe', this)">Descubrir</button>
            <button class="nav-tab" onclick="switchTab('matches', this)">Matches</button>
            <button class="nav-tab" onclick="switchTab('chat', this)">Chat</button>
        </div>

        <div class="content">
            <div id="swipe" class="tab-content active">
                <div class="swipe-container">
                    <div class="cards-stack" id="cards-container">
                         <div class="empty-state" style="display:none;">
                            <h3>No hay m√°s perfiles</h3>
                            <p>Has visto todos los perfiles disponibles</p>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="action-btn reject-btn" onclick="rejectCardManual()">‚úï</button>
                        <button class="action-btn super-like-btn" onclick="superLikeCardManual()">‚≠ê</button>
                        <button class="action-btn like-btn" onclick="likeCardManual()">‚ô•</button>
                    </div>
                </div>
            </div>

            <div id="matches" class="tab-content">
                <div class="matches-container">
                    <div class="matches-grid" id="matches-grid">
                        <div class="empty-state">
                            <h3>No hay matches a√∫n</h3>
                            <p>¬°Sigue deslizando para encontrar matches!</p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="chat" class="tab-content">
                <div class="chat-container">
                    <div class="chat-header" id="chat-header" style="display: none;">
                        <img src="" alt="Profile" id="chat-avatar">
                        <div>
                            <h4 id="chat-name"></h4>
                            <p style="font-size: 12px; opacity: 0.9;">En l√≠nea</p>
                        </div>
                    </div>
                    <div class="chat-messages" id="chat-messages">
                        <div class="empty-state">
                            <h3>Selecciona un match</h3>
                            <p>Elige un match para empezar a chatear</p>
                        </div>
                    </div>
                    <div class="typing-indicator" id="ai-typing-indicator-template" style="display: none;">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                    <div class="chat-input" id="chat-input" style="display: none;">
                        <input type="text" placeholder="Escribe un mensaje..." id="message-input">
                        <button class="send-btn" onclick="sendMessage()">Enviar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="match-popup" id="match-popup">
        <div class="match-content">
            <h2>¬°Es un Match! üéâ</h2>
            <p id="match-message">A ambos se gustaron. ¬°Empiecen una conversaci√≥n!</p>
            <button class="match-btn" onclick="closeMatchPopup()">Continuar</button>
        </div>
    </div>

    <script>
        // Perfiles de Embriolog√≠a (Cap√≠tulos 1, 2, 3, 4 y 5 de Langman)
        const profiles = [
            // Cap√≠tulo 1: Introducci√≥n a la regulaci√≥n y la se√±alizaci√≥n moleculares
            {
                id: 1, name: "Cromatina",
                description: "Estructura de ADN y prote√≠nas que regula la expresi√≥n g√©nica. Se transforma en eucromatina para permitir la transcripci√≥n.",
                image: "https://source.unsplash.com/400x300/?biology,chromatin,dna",
                type: "estructura", chapter: "Cap√≠tulo 1", importance: "Alta",
                keywords: ["ADN", "histonas", "expresi√≥n g√©nica", "nucleosomas", "epigen√©tica"]
            },
            {
                id: 2, name: "Nucleosoma",
                description: "Unidad b√°sica de la cromatina, enrolla el ADN con histonas. Permite compactar el ADN y controlar su acceso.",
                image: "https://source.unsplash.com/400x300/?biology,nucleosome,histone",
                type: "estructura", chapter: "Cap√≠tulo 1", importance: "Alta",
                keywords: ["histonas", "oct√°mero", "compactaci√≥n ADN"]
            },
            {
                id: 3, name: "Eucromatina",
                description: "Forma relajada de la cromatina que permite la transcripci√≥n activa.",
                image: "https://source.unsplash.com/400x300/?biology,euchromatin,gene+expression",
                type: "estructura", chapter: "Cap√≠tulo 1", importance: "Alta",
                keywords: ["transcripci√≥n activa", "acetilaci√≥n", "genes activos"]
            },
            {
                id: 4, name: "Heterocromatina",
                description: "Forma densa e inactiva de cromatina que impide la transcripci√≥n.",
                image: "https://source.unsplash.com/400x300/?biology,heterochromatin,gene+silencing",
                type: "estructura", chapter: "Cap√≠tulo 1", importance: "Alta",
                keywords: ["silenciamiento g√©nico", "condensaci√≥n ADN"]
            },
            {
                id: 5, name: "Promotor",
                description: "Regi√≥n del ADN donde inicia la transcripci√≥n al unirse la ARN polimerasa.",
                image: "https://source.unsplash.com/400x300/?biology,gene+promoter,rna+polymerase",
                type: "estructura", chapter: "Cap√≠tulo 1", importance: "Cr√≠tica",
                keywords: ["caja TATA", "ARN polimerasa", "inicio transcripci√≥n"]
            },
            {
                id: 6, name: "Caja TATA",
                description: "Secuencia espec√≠fica del promotor donde se une la ARN polimerasa con ayuda de factores de transcripci√≥n.",
                image: "https://source.unsplash.com/400x300/?genetics,TATA+box,promoter",
                type: "estructura", chapter: "Cap√≠tulo 1", importance: "Alta",
                keywords: ["promotor", "secuencia ADN", "ARN polimerasa", "transcripci√≥n"]
            },
            {
                id: 7, name: "Factores de transcripci√≥n",
                description: "Prote√≠nas que regulan la expresi√≥n gen√©tica activando o inhibiendo genes.",
                image: "https://source.unsplash.com/400x300/?biology,transcription+factor,protein",
                type: "estructura", chapter: "Cap√≠tulo 1", importance: "Cr√≠tica",
                keywords: ["regulaci√≥n g√©nica", "activaci√≥n", "represi√≥n", "prote√≠nas ADN"]
            },
            {
                id: 8, name: "Potenciadores",
                description: "Secuencias reguladoras de ADN que aumentan la eficiencia de los promotores.",
                image: "https://source.unsplash.com/400x300/?genetics,enhancer+sequence,dna",
                type: "estructura", chapter: "Cap√≠tulo 1", importance: "Alta",
                keywords: ["ADN regulador", "promotores", "eficiencia transcripci√≥n"]
            },
            {
                id: 9, name: "Silenciadores",
                description: "Secuencias de ADN que reprimen la transcripci√≥n g√©nica.",
                image: "https://source.unsplash.com/400x300/?genetics,silencer+sequence,dna",
                type: "estructura", chapter: "Cap√≠tulo 1", importance: "Alta",
                keywords: ["ADN regulador", "represi√≥n g√©nica", "transcripci√≥n"]
            },
            {
                id: 10, name: "Metilaci√≥n del ADN",
                description: "Modificaci√≥n epigen√©tica que inhibe la transcripci√≥n de genes.",
                image: "https://source.unsplash.com/400x300/?biology,dna+methylation,epigenetics",
                type: "proceso", chapter: "Cap√≠tulo 1", importance: "Alta",
                keywords: ["epigen√©tica", "silenciamiento g√©nico", "modificaci√≥n ADN"]
            },
            {
                id: 11, name: "ARN nuclear (ARNn)",
                description: "Transcrito inicial de un gen que incluye intrones y exones.",
                image: "https://source.unsplash.com/400x300/?biology,rna,gene+transcription",
                type: "estructura", chapter: "Cap√≠tulo 1", importance: "Media",
                keywords: ["transcrito primario", "intrones", "exones", "procesamiento ARN"]
            },
            {
                id: 12, name: "Empalme alternativo",
                description: "Proceso que permite generar diferentes prote√≠nas a partir de un solo gen.",
                image: "https://source.unsplash.com/400x300/?biology,rna+splicing,alternative+splicing",
                type: "proceso", chapter: "Cap√≠tulo 1", importance: "Alta",
                keywords: ["procesamiento ARN", "diversidad proteica", "isoformas"]
            },
            {
                id: 13, name: "Isoformas de empalme",
                description: "Variantes de prote√≠nas generadas por empalme alternativo.",
                image: "https://source.unsplash.com/400x300/?biology,protein+isoforms,splicing",
                type: "estructura", chapter: "Cap√≠tulo 1", importance: "Media",
                keywords: ["prote√≠nas variantes", "empalme alternativo", "diversidad funcional"]
            },
            {
                id: 14, name: "Inducci√≥n",
                description: "Proceso por el cual un tejido determina el destino de otro.",
                image: "https://source.unsplash.com/400x300/?embryology,cell+induction,development",
                type: "proceso", chapter: "Cap√≠tulo 1", importance: "Cr√≠tica",
                keywords: ["desarrollo embrionario", "destino celular", "se√±alizaci√≥n"]
            },
            {
                id: 15, name: "Competencia",
                description: "Capacidad de una c√©lula para responder a se√±ales inductivas.",
                image: "https://source.unsplash.com/400x300/?biology,cell+signaling,competence",
                type: "proceso", chapter: "Cap√≠tulo 1", importance: "Alta",
                keywords: ["respuesta celular", "se√±ales inductivas", "desarrollo"]
            },
            {
                id: 16, name: "Interacciones epitelio-mes√©nquima",
                description: "Comunicaci√≥n entre capas celulares que regula la organog√©nesis.",
                image: "https://source.unsplash.com/400x300/?embryology,epithelium,mesenchyme,organogenesis",
                type: "proceso", chapter: "Cap√≠tulo 1", importance: "Cr√≠tica",
                keywords: ["organog√©nesis", "comunicaci√≥n celular", "desarrollo √≥rganos"]
            },
            {
                id: 17, name: "Factores paracrinos",
                description: "Mol√©culas se√±alizadoras que difunden entre c√©lulas cercanas.",
                image: "https://source.unsplash.com/400x300/?biology,paracrine+signaling,cell+communication",
                type: "estructura", chapter: "Cap√≠tulo 1", importance: "Alta",
                keywords: ["se√±alizaci√≥n celular", "mol√©culas difusibles", "comunicaci√≥n local"]
            },
            {
                id: 18, name: "V√≠a SHH",
                description: "Ruta de se√±alizaci√≥n crucial para patrones embrionarios.",
                image: "https://source.unsplash.com/400x300/?biology,signaling+pathway,hedgehog",
                type: "proceso", chapter: "Cap√≠tulo 1", importance: "Cr√≠tica",
                keywords: ["Sonic Hedgehog", "patrones embrionarios", "desarrollo"]
            },
            {
                id: 19, name: "V√≠a WNT",
                description: "Ruta de se√±alizaci√≥n para polaridad y elongaci√≥n celular.",
                image: "https://source.unsplash.com/400x300/?biology,signaling+pathway,wnt",
                type: "proceso", chapter: "Cap√≠tulo 1", importance: "Cr√≠tica",
                keywords: ["polaridad celular", "elongaci√≥n", "desarrollo", "Œ≤-catenina"]
            },
            {
                id: 20, name: "V√≠a Notch",
                description: "Se√±alizaci√≥n yuxtacrina clave en la diferenciaci√≥n celular.",
                image: "https://source.unsplash.com/400x300/?biology,signaling+pathway,notch",
                type: "proceso", chapter: "Cap√≠tulo 1", importance: "Cr√≠tica",
                keywords: ["diferenciaci√≥n celular", "se√±alizaci√≥n yuxtacrina", "destino celular"]
            },
             // Patolog√≠as Cap√≠tulo 1
            {
                id: 21, name: "S√≠ndrome de Rett",
                description: "Mutaci√≥n en genes de metilaci√≥n del ADN, afecta el neurodesarrollo en mujeres.",
                image: "https://source.unsplash.com/400x300/?medical,neurology,Rett+syndrome",
                type: "patologia", chapter: "Cap√≠tulo 1", importance: "Alta",
                keywords: ["MECP2", "metilaci√≥n ADN", "neurodesarrollo", "gen√©tico"]
            },
            {
                id: 22, name: "S√≠ndrome de Prader-Willi",
                description: "Error en la impronta gen√©tica del cromosoma paterno.",
                image: "https://source.unsplash.com/400x300/?medical,genetics,Prader-Willi",
                type: "patologia", chapter: "Cap√≠tulo 1", importance: "Alta",
                keywords: ["impronta gen√©tica", "cromosoma 15", "obesidad", "hipoton√≠a"]
            },
            {
                id: 23, name: "S√≠ndrome de Angelman",
                description: "Error en la impronta gen√©tica del cromosoma materno.",
                image: "https://source.unsplash.com/400x300/?medical,genetics,Angelman+syndrome",
                type: "patologia", chapter: "Cap√≠tulo 1", importance: "Alta",
                keywords: ["impronta gen√©tica", "UBE3A", "retraso desarrollo", "epilepsia"]
            },
            {
                id: 24, name: "C√°ncer (regulaci√≥n g√©nica)",
                description: "Expresi√≥n aberrante de genes por mutaciones en promotores o silenciadores.",
                image: "https://source.unsplash.com/400x300/?medical,cancer,gene+regulation",
                type: "patologia", chapter: "Cap√≠tulo 1", importance: "Cr√≠tica",
                keywords: ["mutaciones", "promotores", "silenciadores", "expresi√≥n g√©nica aberrante"]
            },
            {
                id: 25, name: "S√≠ndrome de Alagille",
                description: "Mutaciones en la v√≠a Notch que afectan √≥rganos como el coraz√≥n y el h√≠gado.",
                image: "https://source.unsplash.com/400x300/?medical,genetics,Alagille+syndrome",
                type: "patologia", chapter: "Cap√≠tulo 1", importance: "Alta",
                keywords: ["v√≠a Notch", "JAGGED1", "colestasis", "cardiopat√≠a"]
            },
            {
                id: 26, name: "Holoprosencefalia",
                description: "Falla en SHH que impide la correcta divisi√≥n del cerebro anterior.",
                image: "https://source.unsplash.com/400x300/?medical,brain+development,holoprosencephaly",
                type: "patologia", chapter: "Cap√≠tulo 1", importance: "Cr√≠tica",
                keywords: ["v√≠a SHH", "prosenc√©falo", "divisi√≥n cerebral", "malformaci√≥n"]
            },
            {
                id: 27, name: "Craneosinostosis",
                description: "Mutaci√≥n en FGFR (relacionado a se√±ales FGF) que causa cierre prematuro de suturas craneales.",
                image: "https://source.unsplash.com/400x300/?medical,skull,craniosynostosis",
                type: "patologia", chapter: "Cap√≠tulo 1", importance: "Alta",
                keywords: ["FGFR", "suturas craneales", "cierre prematuro", "desarrollo √≥seo"]
            },
            {
                id: 28, name: "Defectos del tubo neural",
                description: "Mutaciones en la v√≠a WNT/PCP alteran la convergencia celular.",
                image: "https://source.unsplash.com/400x300/?medical,neural+tube+defect,spina+bifida",
                type: "patologia", chapter: "Cap√≠tulo 1", importance: "Cr√≠tica",
                keywords: ["v√≠a WNT", "tubo neural", "convergencia celular", "anencefalia", "espina b√≠fida"]
            },
            {
                id: 29, name: "Focomelia por talidomida",
                description: "Falla en interacciones epitelio-mes√©nquima por efecto teratog√©nico.",
                image: "https://source.unsplash.com/400x300/?medical,history,thalidomide,phocomelia",
                type: "patologia", chapter: "Cap√≠tulo 1", importance: "Hist√≥rica",
                keywords: ["talidomida", "interacciones epitelio-mes√©nquima", "terat√≥geno", "desarrollo extremidades"]
            },
            {
                id: 30, name: "S√≠ndrome de Holt-Oram",
                description: "Alteraciones en genes de se√±alizaci√≥n que afectan coraz√≥n y extremidades.",
                image: "https://source.unsplash.com/400x300/?medical,genetics,Holt-Oram+syndrome",
                type: "patologia", chapter: "Cap√≠tulo 1", importance: "Alta",
                keywords: ["se√±alizaci√≥n TBX5", "desarrollo coraz√≥n", "desarrollo extremidades superiores"]
            },

            // Cap√≠tulo 2: Gametog√©nesis
            {
                id: 31, name: "C√©lulas germinales primordiales",
                description: "C√©lulas precursoras de los gametos que migran al saco vitelino en la semana 2 y a las g√≥nadas en la 5.",
                image: "https://source.unsplash.com/400x300/?embryology,germ+cells,gametes",
                type: "estructura", chapter: "Cap√≠tulo 2", importance: "Cr√≠tica",
                keywords: ["CGP", "gametos", "migraci√≥n", "saco vitelino", "g√≥nadas"]
            },
            {
                id: 32, name: "Epiblasto", 
                description: "Capa del embri√≥n que origina todas las capas germinales y las CGP. Capa superior del disco bilaminar.",
                image: "https://source.unsplash.com/400x300/?embryology,epiblast,embryonic+disc",
                type: "estructura", chapter: "Cap√≠tulo 2 y 4", importance: "Cr√≠tica",
                keywords: ["embri√≥n", "capas germinales", "CGP", "desarrollo temprano", "disco bilaminar"]
            },
            {
                id: 33, name: "Estr√≠a primitiva", 
                description: "Engrosamiento celular transitorio en la l√≠nea media de la superficie dorsal del Epiblasto del embri√≥n, visible al inicio de la tercera semana. Es el punto de inicio de la gastrulaci√≥n y permite la migraci√≥n celular para formar las tres capas germinativas.",
                image: "https://source.unsplash.com/400x300/?embryology,primitive+streak,gastrulation",
                type: "estructura", chapter: "Cap√≠tulo 2, 3 y 5", importance: "Cr√≠tica", 
                keywords: ["gastrulaci√≥n", "migraci√≥n celular", "mesodermo", "epiblasto", "l√≠nea primitiva", "nodo primitivo", "tercera semana"]
            },
            {
                id: 34, name: "Saco vitelino", 
                description: "Sitio temporal donde migran las CGP antes de llegar a las g√≥nadas. Contribuye a membranas y estructuras de soporte.",
                image: "https://source.unsplash.com/400x300/?embryology,yolk+sac",
                type: "estructura", chapter: "Cap√≠tulo 2, 3 y 4", importance: "Media", // Cap√≠tulo 3 lo implica, 4 lo detalla (primario, secundario, terciario)
                keywords: ["CGP", "migraci√≥n", "nutrici√≥n temprana", "anexos embrionarios", "hipoblasto", "saco vitelino primario", "saco vitelino secundario"]
            },
            {
                id: 35, name: "G√≥nadas en desarrollo",
                description: "√ìrganos donde maduran las CGP en gametos.",
                image: "https://source.unsplash.com/400x300/?embryology,gonads,ovary,testis",
                type: "estructura", chapter: "Cap√≠tulo 2", importance: "Alta",
                keywords: ["ovarios", "test√≠culos", "gametog√©nesis", "maduraci√≥n CGP"]
            },
            {
                id: 36, name: "Meiosis",
                description: "Divisi√≥n celular que reduce el n√∫mero de cromosomas a la mitad en gametos.",
                image: "https://source.unsplash.com/400x300/?biology,cell+division,meiosis",
                type: "proceso", chapter: "Cap√≠tulo 2", importance: "Cr√≠tica",
                keywords: ["divisi√≥n celular", "cromosomas", "gametos", "haploide", "variabilidad gen√©tica"]
            },
            {
                id: 37, name: "Citodiferenciaci√≥n",
                description: "Proceso mediante el cual los gametos adquieren su forma y funci√≥n final.",
                image: "https://source.unsplash.com/400x300/?biology,cell+differentiation,gamete",
                type: "proceso", chapter: "Cap√≠tulo 2", importance: "Alta",
                keywords: ["gametos", "maduraci√≥n", "especializaci√≥n celular", "forma funcional"]
            },
            {
                id: 38, name: "Espermatogonia",
                description: "C√©lula germinal masculina que sufre mitosis y luego meiosis.",
                image: "https://source.unsplash.com/400x300/?embryology,spermatogonia,sperm",
                type: "estructura", chapter: "Cap√≠tulo 2", importance: "Alta",
                keywords: ["c√©lula germinal", "masculino", "mitosis", "meiosis", "espermatog√©nesis"]
            },
            {
                id: 39, name: "Ovogonia",
                description: "C√©lula germinal femenina que inicia meiosis y se detiene hasta la pubertad.",
                image: "https://source.unsplash.com/400x300/?embryology,oogonia,ovum",
                type: "estructura", chapter: "Cap√≠tulo 2", importance: "Alta",
                keywords: ["c√©lula germinal", "femenino", "meiosis", "pubertad", "ovog√©nesis"]
            },
            {
                id: 40, name: "Ovocito primario",
                description: "C√©lula detenida en profase I hasta la ovulaci√≥n.",
                image: "https://source.unsplash.com/400x300/?embryology,primary+oocyte",
                type: "estructura", chapter: "Cap√≠tulo 2", importance: "Alta",
                keywords: ["profase I", "ovulaci√≥n", "meiosis I", "gameto femenino"]
            },
            {
                id: 41, name: "Ovocito secundario", 
                description: "C√©lula detenida en metafase II hasta la fecundaci√≥n. Es liberada desde el ovario durante la ovulaci√≥n.",
                image: "https://source.unsplash.com/400x300/?embryology,secondary+oocyte,ovulation",
                type: "estructura", chapter: "Cap√≠tulo 2 y 3", importance: "Cr√≠tica",
                keywords: ["metafase II", "fecundaci√≥n", "meiosis II", "√≥vulo", "ovulaci√≥n"]
            },
            {
                id: 42, name: "Cuerpo polar",
                description: "Subproducto celular de la meiosis femenina que se degenera.",
                image: "https://source.unsplash.com/400x300/?embryology,polar+body,oogenesis",
                type: "estructura", chapter: "Cap√≠tulo 2", importance: "Media",
                keywords: ["meiosis femenina", "degeneraci√≥n", "ovog√©nesis", "subproducto"]
            },
            {
                id: 43, name: "Esperm√°tide",
                description: "Producto haploide de la meiosis que se convierte en espermatozoide.",
                image: "https://source.unsplash.com/400x300/?embryology,spermatid",
                type: "estructura", chapter: "Cap√≠tulo 2", importance: "Media",
                keywords: ["haploide", "meiosis masculina", "espermiog√©nesis", "precursor espermatozoide"]
            },
            {
                id: 44, name: "Espermiog√©nesis",
                description: "Transformaci√≥n de esperm√°tides en espermatozoides maduros.",
                image: "https://source.unsplash.com/400x300/?embryology,spermiogenesis,sperm+maturation",
                type: "proceso", chapter: "Cap√≠tulo 2", importance: "Alta",
                keywords: ["esperm√°tide", "espermatozoide", "maduraci√≥n", "citodiferenciaci√≥n"]
            },
            {
                id: 45, name: "Zona pel√∫cida", 
                description: "Capa de glicoprote√≠nas que rodea al ovocito y es clave en la fecundaci√≥n. Debe eliminarse para la implantaci√≥n.",
                image: "https://source.unsplash.com/400x300/?embryology,zona+pellucida,oocyte",
                type: "estructura", chapter: "Cap√≠tulo 2 y 3", importance: "Cr√≠tica",
                keywords: ["glicoprote√≠nas", "ovocito", "fecundaci√≥n", "reacci√≥n acros√≥mica", "eclosi√≥n"]
            },
            {
                id: 46, name: "Corona radiada",
                description: "Capa de c√©lulas foliculares que rodea al ovocito.",
                image: "https://source.unsplash.com/400x300/?embryology,corona+radiata,follicle+cells",
                type: "estructura", chapter: "Cap√≠tulo 2", importance: "Alta",
                keywords: ["c√©lulas foliculares", "ovocito", "protecci√≥n", "nutrici√≥n"]
            },
            {
                id: 47, name: "Acrosoma",
                description: "Organelo del espermatozoide que permite penetrar la zona pel√∫cida.",
                image: "https://source.unsplash.com/400x300/?embryology,acrosome,sperm",
                type: "estructura", chapter: "Cap√≠tulo 2", importance: "Cr√≠tica",
                keywords: ["espermatozoide", "enzimas", "penetraci√≥n", "zona pel√∫cida", "fecundaci√≥n"]
            },
            {
                id: 48, name: "Ovulaci√≥n", 
                description: "Liberaci√≥n del ovocito secundario desde el ovario, ocurre alrededor del d√≠a 14 del ciclo, hacia la trompa uterina.",
                image: "https://source.unsplash.com/400x300/?biology,ovulation,oocyte+release",
                type: "proceso", chapter: "Cap√≠tulo 2 y 3", importance: "Cr√≠tica",
                keywords: ["ovocito secundario", "trompa uterina", "ciclo ov√°rico", "liberaci√≥n", "fimbrias"]
            },
            {
                id: 49, name: "Menarquia",
                description: "Inicio de la ovulaci√≥n en la pubertad femenina.",
                image: "https://source.unsplash.com/400x300/?female+puberty,menarche,menstruation",
                type: "proceso", chapter: "Cap√≠tulo 2", importance: "Media",
                keywords: ["ovulaci√≥n", "pubertad femenina", "ciclo menstrual", "inicio fertilidad"]
            },
            {
                id: 50, name: "Espermarquia",
                description: "Inicio de la producci√≥n de espermatozoides en la pubertad masculina.",
                image: "https://source.unsplash.com/400x300/?male+puberty,spermarche,sperm+production",
                type: "proceso", chapter: "Cap√≠tulo 2", importance: "Media",
                keywords: ["espermatozoides", "pubertad masculina", "espermatog√©nesis", "inicio fertilidad"]
            },
            {
                id: 51, name: "Teratoma", 
                description: "Tumor de c√©lulas germinales fuera de lugar, derivado de CGP migrantes. Puede contener tejidos de las tres capas germinativas. Los teratomas sacrococc√≠geos se originan de remanentes de la estr√≠a primitiva.",
                image: "https://source.unsplash.com/400x300/?medical,tumor,teratoma",
                type: "patologia", chapter: "Cap√≠tulo 2 y 5", importance: "Alta",
                keywords: ["tumor", "c√©lulas germinales", "CGP", "migraci√≥n an√≥mala", "tejidos m√∫ltiples", "sacrococc√≠geo", "estr√≠a primitiva"]
            },
            {
                id: 52, name: "S√≠ndrome de Turner",
                description: "Monosom√≠a X que afecta la ovog√©nesis y desarrollo gonadal.",
                image: "https://source.unsplash.com/400x300/?medical,genetics,Turner+syndrome",
                type: "patologia", chapter: "Cap√≠tulo 2", importance: "Alta",
                keywords: ["monosom√≠a X", "45,X", "ovog√©nesis", "desarrollo gonadal", "infertilidad femenina"]
            },
            {
                id: 53, name: "S√≠ndrome de Klinefelter",
                description: "XXY; provoca atrofia testicular y espermatog√©nesis deficiente.",
                image: "https://source.unsplash.com/400x300/?medical,genetics,Klinefelter+syndrome",
                type: "patologia", chapter: "Cap√≠tulo 2", importance: "Alta",
                keywords: ["XXY", "47,XXY", "atrofia testicular", "espermatog√©nesis deficiente", "infertilidad masculina"]
            },
            {
                id: 54, name: "Azoospermia",
                description: "Ausencia de espermatozoides por falla en la espermatog√©nesis.",
                image: "https://source.unsplash.com/400x300/?medical,infertility,azoospermia",
                type: "patologia", chapter: "Cap√≠tulo 2", importance: "Alta",
                keywords: ["ausencia espermatozoides", "espermatog√©nesis", "infertilidad masculina", "falla testicular"]
            },
            {
                id: 55, name: "Anovulaci√≥n",
                description: "Falla en la liberaci√≥n del ovocito, relacionada con infertilidad.",
                image: "https://source.unsplash.com/400x300/?medical,infertility,anovulation",
                type: "patologia", chapter: "Cap√≠tulo 2", importance: "Alta",
                keywords: ["falla ovulaci√≥n", "liberaci√≥n ovocito", "infertilidad femenina", "ciclo irregular"]
            },
            {
                id: 56, name: "Fallo gonadal prematuro",
                description: "Cese temprano de la funci√≥n ov√°rica o testicular.",
                image: "https://source.unsplash.com/400x300/?medical,hormones,gonadal+failure",
                type: "patologia", chapter: "Cap√≠tulo 2", importance: "Alta",
                keywords: ["cese funci√≥n gonadal", "menopausia precoz", "andropausia precoz", "infertilidad"]
            },
            {
                id: 57, name: "S√≠ndrome de Swyer",
                description: "Cariotipo XY con g√≥nadas disgen√©ticas femeninas.",
                image: "https://source.unsplash.com/400x300/?medical,genetics,Swyer+syndrome",
                type: "patologia", chapter: "Cap√≠tulo 2", importance: "Alta",
                keywords: ["cariotipo XY", "g√≥nadas disgen√©ticas", "fenotipo femenino", "SRY", "infertilidad"]
            },
            {
                id: 58, name: "S√≠ndrome de Morris",
                description: "Insensibilidad a andr√≥genos en personas XY, fenotipo femenino.",
                image: "https://source.unsplash.com/400x300/?medical,genetics,androgen+insensitivity",
                type: "patologia", chapter: "Cap√≠tulo 2", importance: "Alta",
                keywords: ["insensibilidad andr√≥genos", "AIS", "XY", "fenotipo femenino", "receptor androg√©nico"]
            },
            {
                id: 59, name: "Disgenesia gonadal",
                description: "Desarrollo an√≥malo de las g√≥nadas, causa de infertilidad.",
                image: "https://source.unsplash.com/400x300/?medical,genetics,gonadal+dysgenesis",
                type: "patologia", chapter: "Cap√≠tulo 2", importance: "Alta",
                keywords: ["desarrollo an√≥malo g√≥nadas", "infertilidad", "alteraci√≥n hormonal", "ovarios", "test√≠culos"]
            },
            {
                id: 60, name: "Mosaicismo cromos√≥mico",
                description: "Errores en la meiosis pueden causar individuos con c√©lulas de distinto cariotipo.",
                image: "https://source.unsplash.com/400x300/?genetics,chromosome,mosaicism",
                type: "patologia", chapter: "Cap√≠tulo 2", importance: "Media",
                keywords: ["errores meiosis", "cariotipo mixto", "no disyunci√≥n mit√≥tica", "variabilidad fenot√≠pica"]
            },

            // Cap√≠tulo 3
            {
                id: 61, name: "Fimbrias",
                description: "Estructuras en forma de dedos al final de la trompa de Falopio que capturan el ovocito tras la ovulaci√≥n.",
                image: "https://source.unsplash.com/400x300/?anatomy,fallopian+tube,fimbriae",
                type: "estructura", chapter: "Cap√≠tulo 3", importance: "Alta",
                keywords: ["trompa de Falopio", "captura ovocito", "ovulaci√≥n"]
            },
            {
                id: 62, name: "Esperma", 
                description: "Gameto masculino maduro y m√≥vil que busca fecundar al ovocito.",
                image: "https://source.unsplash.com/400x300/?science,sperm,gamete",
                type: "estructura", chapter: "Cap√≠tulo 3", importance: "Cr√≠tica",
                keywords: ["gameto masculino", "fecundaci√≥n", "m√≥vil", "haploide"]
            },
            {
                id: 63, name: "Capacitaci√≥n esperm√°tica",
                description: "Proceso de acondicionamiento final que ocurre en el tracto reproductor femenino y prepara al esperma para fecundar.",
                image: "https://source.unsplash.com/400x300/?biology,sperm+capacitation,fertilization",
                type: "proceso", chapter: "Cap√≠tulo 3", importance: "Cr√≠tica",
                keywords: ["tracto femenino", "acondicionamiento esperma", "fecundaci√≥n"]
            },
            {
                id: 64, name: "Reacci√≥n acros√≥mica",
                description: "Liberaci√≥n de enzimas del acrosoma del espermatozoide para penetrar la zona pel√∫cida del ovocito.",
                image: "https://source.unsplash.com/400x300/?biology,acrosome+reaction,sperm+fertilization",
                type: "proceso", chapter: "Cap√≠tulo 3", importance: "Cr√≠tica",
                keywords: ["acrosoma", "enzimas", "zona pel√∫cida", "penetraci√≥n ovocito"]
            },
            {
                id: 65, name: "Fecundaci√≥n",
                description: "Uni√≥n del ovocito y el espermatozoide, usualmente en la ampolla de la trompa de Falopio.",
                image: "https://source.unsplash.com/400x300/?embryology,fertilization,zygote",
                type: "proceso", chapter: "Cap√≠tulo 3", importance: "Cr√≠tica",
                keywords: ["uni√≥n gametos", "ampolla", "trompa Falopio", "cigoto"]
            },
            {
                id: 66, name: "Cigoto",
                description: "C√©lula diploide resultante de la fecundaci√≥n, el primer estadio del embri√≥n.",
                image: "https://source.unsplash.com/400x300/?embryology,zygote,cell",
                type: "estructura", chapter: "Cap√≠tulo 3", importance: "Cr√≠tica",
                keywords: ["diploide", "fecundaci√≥n", "embri√≥n temprano", "segmentaci√≥n"]
            },
            {
                id: 67, name: "Segmentaci√≥n",
                description: "Serie de divisiones mit√≥ticas tempranas del cigoto sin crecimiento celular significativo, formando blast√≥meros.",
                image: "https://source.unsplash.com/400x300/?embryology,cleavage,mitosis,blastomere",
                type: "proceso", chapter: "Cap√≠tulo 3", importance: "Alta",
                keywords: ["divisiones mit√≥ticas", "cigoto", "blast√≥meros", "m√≥rula"]
            },
            {
                id: 68, name: "M√≥rula",
                description: "Esfera s√≥lida de blast√≥meros (usualmente 16-32 c√©lulas) que aparece alrededor del d√≠a 3 post-fecundaci√≥n.",
                image: "https://source.unsplash.com/400x300/?embryology,morula,blastomere",
                type: "estructura", chapter: "Cap√≠tulo 3", importance: "Alta",
                keywords: ["blast√≥meros", "segmentaci√≥n", "d√≠a 3", "compactaci√≥n"]
            },
            {
                id: 69, name: "Compactaci√≥n",
                description: "Proceso en el que las c√©lulas externas de la m√≥rula se adhieren estrechamente mediante uniones intercelulares, aplan√°ndose y polariz√°ndose.",
                image: "https://source.unsplash.com/400x300/?embryology,compaction,morula+development",
                type: "proceso", chapter: "Cap√≠tulo 3", importance: "Alta",
                keywords: ["m√≥rula", "adhesi√≥n celular", "blastocisto", "diferenciaci√≥n temprana"]
            },
            {
                id: 70, name: "Blastocisto",
                description: "Estructura formada alrededor del d√≠a 4-5, con una cavidad central (blastocele) y dos grupos celulares diferenciados: embrioblasto y trofoblasto.",
                image: "https://source.unsplash.com/400x300/?embryology,blastocyst,embryo+implantation",
                type: "estructura", chapter: "Cap√≠tulo 3", importance: "Cr√≠tica",
                keywords: ["blastocele", "embrioblasto", "trofoblasto", "implantaci√≥n"]
            },
            {
                id: 71, name: "Blastocele",
                description: "Cavidad llena de l√≠quido que se forma en el interior del blastocisto.",
                image: "https://source.unsplash.com/400x300/?embryology,blastocoele,blastocyst+cavity",
                type: "estructura", chapter: "Cap√≠tulo 3", importance: "Media",
                keywords: ["cavidad blastocisto", "l√≠quido", "desarrollo temprano"]
            },
            {
                id: 72, name: "Embrioblasto", 
                description: "Grupo de c√©lulas internas del blastocisto (masa celular interna) que formar√°n el embri√≥n propiamente dicho. En la segunda semana, se diferencia en epiblasto e hipoblasto.",
                image: "https://source.unsplash.com/400x300/?embryology,embryoblast,inner+cell+mass",
                type: "estructura", chapter: "Cap√≠tulo 3 y 4", importance: "Cr√≠tica",
                keywords: ["masa celular interna", "blastocisto", "formaci√≥n embri√≥n", "pluripotente", "epiblasto", "disco bilaminar"]
            },
            {
                id: 73, name: "Trofoectodermo", 
                description: "Capa externa de c√©lulas del blastocisto que dar√° origen a la parte embrionaria de la placenta y membranas extraembrionarias. Se diferencia en citotrofoblasto y sincitiotrofoblasto.",
                image: "https://source.unsplash.com/400x300/?embryology,trophectoderm,trophoblast,placenta",
                type: "estructura", chapter: "Cap√≠tulo 3 y 4", importance: "Cr√≠tica",
                keywords: ["capa externa blastocisto", "placenta", "implantaci√≥n", "hCG", "citotrofoblasto", "sincitiotrofoblasto"]
            },
            {
                id: 74, name: "Eclosi√≥n del blastocisto",
                description: "Proceso por el cual el blastocisto se libera de la zona pel√∫cida, usualmente alrededor del d√≠a 5-6, para poder implantarse en el endometrio.",
                image: "https://source.unsplash.com/400x300/?embryology,blastocyst+hatching,implantation",
                type: "proceso", chapter: "Cap√≠tulo 3", importance: "Cr√≠tica",
                keywords: ["blastocisto", "zona pel√∫cida", "implantaci√≥n", "liberaci√≥n"]
            },
            {
                id: 75, name: "Implantaci√≥n",
                description: "Proceso de fijaci√≥n y anidaci√≥n del blastocisto al endometrio uterino, que comienza al final de la primera semana (d√≠a 6-7) y se completa en la segunda.",
                image: "https://source.unsplash.com/400x300/?embryology,implantation,endometrium",
                type: "proceso", chapter: "Cap√≠tulo 3", importance: "Cr√≠tica",
                keywords: ["blastocisto", "endometrio", "fijaci√≥n", "desarrollo placenta"]
            },
            {
                id: 76, name: "Endometrio",
                description: "Capa mucosa interna del √∫tero, ricamente vascularizada y glandular, donde se implanta el blastocisto y se desarrolla la placenta.",
                image: "https://source.unsplash.com/400x300/?anatomy,endometrium,uterus",
                type: "estructura", chapter: "Cap√≠tulo 3", importance: "Alta",
                keywords: ["√∫tero", "implantaci√≥n", "placenta", "ciclo menstrual"]
            },
            {
                id: 77, name: "Hormona hCG",
                description: "Gonadotropina cori√≥nica humana, secretada por el sincitiotrofoblasto (derivado del trofoblasto) poco despu√©s de la implantaci√≥n. Mantiene el cuerpo l√∫teo.",
                image: "https://source.unsplash.com/400x300/?medical,hormone,hCG,pregnancy",
                type: "estructura", chapter: "Cap√≠tulo 3", importance: "Cr√≠tica",
                keywords: ["gonadotropina cori√≥nica", "sincitiotrofoblasto", "cuerpo l√∫teo", "prueba embarazo"]
            },
            {
                id: 78, name: "Cuerpo l√∫teo",
                description: "Estructura endocrina temporal en el ovario, formada a partir del fol√≠culo ov√°rico despu√©s de la ovulaci√≥n. Secreta progesterona (y estr√≥genos) para mantener el endometrio preparado para el embarazo.",
                image: "https://source.unsplash.com/400x300/?anatomy,corpus+luteum,ovary,progesterone",
                type: "estructura", chapter: "Cap√≠tulo 3", importance: "Alta",
                keywords: ["ovario", "progesterona", "mantenimiento endometrio", "embarazo temprano"]
            },
            {
                id: 79, name: "Fertilizaci√≥n fallida",
                description: "Ausencia de uni√≥n entre ovocito y espermatozoide, o falla en la activaci√≥n del ovocito.",
                image: "https://source.unsplash.com/400x300/?medical,infertility,failed+fertilization",
                type: "patologia", chapter: "Cap√≠tulo 3", importance: "Alta",
                keywords: ["infertilidad", "falla uni√≥n gametos", "activaci√≥n ovocito"]
            },
            {
                id: 80, name: "Poliespermia",
                description: "Fertilizaci√≥n de un ovocito por m√°s de un esperma, produce c√©lulas triploides no viables.",
                image: "https://source.unsplash.com/400x300/?embryology,polyspermy,abnormal+fertilization",
                type: "patologia", chapter: "Cap√≠tulo 3", importance: "Alta",
                keywords: ["fertilizaci√≥n m√∫ltiple", "cigoto triploide", "no viable", "bloqueo polispermia"]
            },
            {
                id: 81, name: "Embarazo ect√≥pico",
                description: "Implantaci√≥n del blastocisto fuera de la cavidad uterina, m√°s com√∫nmente en la trompa de Falopio (embarazo tub√°rico).",
                image: "https://source.unsplash.com/400x300/?medical,pregnancy,ectopic+pregnancy",
                type: "patologia", chapter: "Cap√≠tulo 3", importance: "Cr√≠tica",
                keywords: ["implantaci√≥n an√≥mala", "trompa Falopio", "riesgo vital materno"]
            },
            {
                id: 82, name: "Mola hidatiforme", 
                description: "Embarazo an√≥malo caracterizado por la proliferaci√≥n anormal del trofoblasto, con o sin desarrollo embrionario. Puede ser completa (sin embri√≥n, solo trofoblasto proliferante) o parcial.",
                image: "https://source.unsplash.com/400x300/?medical,pregnancy,hydatidiform+mole",
                type: "patologia", chapter: "Cap√≠tulo 3 y 4", importance: "Alta",
                keywords: ["trofoblasto anormal", "embarazo molar", "sin embri√≥n viable", "hCG elevada", "mola completa"]
            },
            {
                id: 83, name: "Fallo en la eclosi√≥n",
                description: "Si el blastocisto no logra salir de la zona pel√∫cida, no puede implantarse en el endometrio.",
                image: "https://source.unsplash.com/400x300/?embryology,blastocyst+hatching+failure,implantation+failure",
                type: "patologia", chapter: "Cap√≠tulo 3", importance: "Alta",
                keywords: ["eclosi√≥n blastocisto", "zona pel√∫cida persistente", "falla implantaci√≥n"]
            },
            {
                id: 84, name: "Implantaci√≥n superficial", 
                description: "Implantaci√≥n del blastocisto de forma muy superficial en el endometrio o demasiado cerca del orificio cervical interno, lo que puede aumentar el riesgo de aborto espont√°neo o placenta previa.",
                image: "https://source.unsplash.com/400x300/?medical,pregnancy,superficial+implantation",
                type: "patologia", chapter: "Cap√≠tulo 3", importance: "Media",
                keywords: ["implantaci√≥n an√≥mala", "riesgo aborto", "placenta previa"]
            },
            {
                id: 85, name: "Baja producci√≥n de hCG", 
                description: "Niveles insuficientes de hormona hCG, a menudo asociados con embarazos no viables, fallo del cuerpo l√∫teo o disfunci√≥n trofobl√°stica.",
                image: "https://source.unsplash.com/400x300/?medical,pregnancy,low+hCG",
                type: "patologia", chapter: "Cap√≠tulo 3 y 4", importance: "Alta",
                keywords: ["hCG insuficiente", "embarazo no viable", "fallo cuerpo l√∫teo", "deficiencia hCG"]
            },
            {
                id: 86, name: "Reacci√≥n inmunol√≥gica materna",
                description: "En raras ocasiones, el sistema inmunol√≥gico materno puede reconocer al embri√≥n (que es semi-alog√©nico) como extra√±o y montar una respuesta que dificulte la implantaci√≥n o el mantenimiento del embarazo.",
                image: "https://source.unsplash.com/400x300/?medical,immunology,pregnancy+rejection",
                type: "patologia", chapter: "Cap√≠tulo 3", importance: "Media",
                keywords: ["rechazo embri√≥n", "sistema inmune materno", "tolerancia inmunol√≥gica"]
            },
            {
                id: 87, name: "Defectos de trofoblasto",
                description: "Fallas en la capacidad del trofoblasto para adherirse adecuadamente al endometrio, invadirlo y establecer una placenta funcional.",
                image: "https://source.unsplash.com/400x300/?embryology,trophoblast+defect,placentation",
                type: "patologia", chapter: "Cap√≠tulo 3", importance: "Alta",
                keywords: ["falla adhesi√≥n trofoblasto", "invasi√≥n endometrial deficiente", "placentaci√≥n anormal"]
            },
            {
                id: 88, name: "S√≠ndrome de Asherman",
                description: "Presencia de adherencias o tejido cicatricial dentro de la cavidad uterina, usualmente como resultado de cirug√≠as uterinas previas o infecciones. Puede dificultar o impedir la implantaci√≥n.",
                image: "https://source.unsplash.com/400x300/?medical,gynecology,Asherman+syndrome",
                type: "patologia", chapter: "Cap√≠tulo 3", importance: "Media",
                keywords: ["adherencias uterinas", "cicatriz endometrial", "falla implantaci√≥n", "infertilidad"]
            },
            // Cap√≠tulo 4
            {
                id: 89, name: "Disco bilaminar",
                description: "Estructura compuesta por epiblasto e hipoblasto que establece la base para la organizaci√≥n del embri√≥n en la segunda semana.",
                image: "https://source.unsplash.com/400x300/?embryology,bilaminar+disc,epiblast,hypoblast",
                type: "estructura", chapter: "Cap√≠tulo 4", importance: "Cr√≠tica",
                keywords: ["epiblasto", "hipoblasto", "segunda semana", "diferenciaci√≥n embrionaria"]
            },
            {
                id: 90, name: "Hipoblasto",
                description: "Capa inferior del disco bilaminar que contribuye a membranas como el saco vitelino y apoya la formaci√≥n del endodermo extraembrionario.",
                image: "https://source.unsplash.com/400x300/?embryology,hypoblast,bilaminar+disc",
                type: "estructura", chapter: "Cap√≠tulo 4", importance: "Alta",
                keywords: ["disco bilaminar", "saco vitelino", "endodermo extraembrionario"]
            },
            {
                id: 91, name: "Cavidad amni√≥tica",
                description: "Espacio lleno de l√≠quido sobre el epiblasto que protege y aloja al embri√≥n en desarrollo temprano.",
                image: "https://source.unsplash.com/400x300/?embryology,amniotic+cavity,amnion",
                type: "estructura", chapter: "Cap√≠tulo 4", importance: "Alta",
                keywords: ["epiblasto", "amnioblastos", "protecci√≥n embri√≥n", "l√≠quido amni√≥tico"]
            },
            {
                id: 92, name: "Amnioblastos",
                description: "C√©lulas derivadas del epiblasto que rodean la cavidad amni√≥tica y forman la membrana amni√≥tica (amnios).",
                image: "https://source.unsplash.com/400x300/?embryology,amnioblast,amniotic+membrane",
                type: "estructura", chapter: "Cap√≠tulo 4", importance: "Media",
                keywords: ["epiblasto", "cavidad amni√≥tica", "amnios"]
            },
            {
                id: 93, name: "Saco vitelino primario",
                description: "Cavidad derivada del hipoblasto, delimitada por la membrana exocel√≥mica (de Heuser), que provee nutrici√≥n inicial al embri√≥n temprano.",
                image: "https://source.unsplash.com/400x300/?embryology,primary+yolk+sac",
                type: "estructura", chapter: "Cap√≠tulo 4", importance: "Media",
                keywords: ["hipoblasto", "membrana exocel√≥mica", "nutrici√≥n temprana"]
            },
            {
                id: 94, name: "Membrana exocel√≥mica (de Heuser)",
                description: "L√°mina delgada de c√©lulas (probablemente derivadas del hipoblasto) que reviste la superficie interna del citotrofoblasto y delimita el saco vitelino primario (cavidad exocel√≥mica).",
                image: "https://source.unsplash.com/400x300/?embryology,exocoelomic+membrane,Heuser+membrane",
                type: "estructura", chapter: "Cap√≠tulo 4", importance: "Media",
                keywords: ["saco vitelino primario", "hipoblasto", "citotrofoblasto", "cavidad exocel√≥mica"]
            },
            {
                id: 95, name: "Mesodermo extraembrionario",
                description: "Capa laxa de tejido conectivo que se forma entre la superficie interna del citotrofoblasto y la superficie externa de la cavidad amni√≥tica y el saco vitelino primario. Permite la formaci√≥n de vasos sangu√≠neos tempranos y el estroma del corion.",
                image: "https://source.unsplash.com/400x300/?embryology,extraembryonic+mesoderm,chorion",
                type: "estructura", chapter: "Cap√≠tulo 4", importance: "Alta",
                keywords: ["citotrofoblasto", "saco vitelino", "corion", "vasos sangu√≠neos", "cavidad cori√≥nica"]
            },
            {
                id: 96, name: "Lacunas trofobl√°sticas",
                description: "Espacios que aparecen dentro del sincitiotrofoblasto y se llenan de sangre materna, iniciando la circulaci√≥n uteroplacentaria.",
                image: "https://source.unsplash.com/400x300/?embryology,trophoblastic+lacunae,placenta+development",
                type: "estructura", chapter: "Cap√≠tulo 4", importance: "Alta",
                keywords: ["sincitiotrofoblasto", "sangre materna", "circulaci√≥n uteroplacentaria"]
            },
            { 
                id: 97, name: "Sincitiotrofoblasto",
                description: "Capa externa multinucleada y altamente invasiva del trofoblasto, derivada del citotrofoblasto. Invade el endometrio, forma las lagunas trofobl√°sticas y produce hCG.",
                image: "https://source.unsplash.com/400x300/?embryology,syncytiotrophoblast,implantation",
                type: "estructura", chapter: "Cap√≠tulo 4", importance: "Cr√≠tica",
                keywords: ["trofoblasto", "invasi√≥n endometrial", "hCG", "lagunas", "placenta"]
            },
            { 
                id: 98, name: "Citotrofoblasto",
                description: "Capa interna celular y proliferativa del trofoblasto. Sus c√©lulas se dividen y fusionan para formar y renovar el sincitiotrofoblasto.",
                image: "https://source.unsplash.com/400x300/?embryology,cytotrophoblast,trophoblast+cells",
                type: "estructura", chapter: "Cap√≠tulo 4", importance: "Cr√≠tica",
                keywords: ["trofoblasto", "sincitiotrofoblasto", "proliferaci√≥n celular", "placenta"]
            },
            {
                id: 99, name: "Cavidad cori√≥nica",
                description: "Gran espacio lleno de l√≠quido que se forma dentro del mesodermo extraembrionario, rodeando el saco amni√≥tico y el saco vitelino, excepto donde est√°n unidos al corion por el ped√≠culo de fijaci√≥n. Permite la movilidad y el crecimiento del embri√≥n.",
                image: "https://source.unsplash.com/400x300/?embryology,chorionic+cavity,extraembryonic+coelom",
                type: "estructura", chapter: "Cap√≠tulo 4", importance: "Alta",
                keywords: ["mesodermo extraembrionario", "corion", "suspensi√≥n embrionaria", "celoma extraembrionario"]
            },
            {
                id: 100, name: "Ped√≠culo de fijaci√≥n",
                description: "Banda de mesodermo extraembrionario que conecta el disco embrionario (con sus cavidades amni√≥tica y vitelina) al trofoblasto (corion). Se convertir√° en el cord√≥n umbilical.",
                image: "https://source.unsplash.com/400x300/?embryology,connecting+stalk,umbilical+cord",
                type: "estructura", chapter: "Cap√≠tulo 4", importance: "Cr√≠tica",
                keywords: ["mesodermo extraembrionario", "corion", "cord√≥n umbilical", "fijaci√≥n embri√≥n"]
            },
            { 
                id: 101, name: "Saco vitelino secundario",
                description: "Estructura m√°s peque√±a que reemplaza al saco vitelino primario. Se forma cuando c√©lulas del hipoblasto migran y revisten la membrana exocel√≥mica, mientras el saco primario se desprende. Nutre al embri√≥n antes de que la placenta sea funcional.",
                image: "https://source.unsplash.com/400x300/?embryology,secondary+yolk+sac",
                type: "estructura", chapter: "Cap√≠tulo 4", importance: "Media",
                keywords: ["hipoblasto", "nutrici√≥n embrionaria", "reemplaza saco primario"]
            },
            {
                id: 102, name: "C√©lulas del hipoblasto",
                description: "C√©lulas de la capa inferior del disco bilaminar que originan membranas y estructuras de soporte, como el saco vitelino y la membrana exocel√≥mica (de Heuser). Forman el endodermo extraembrionario.",
                image: "https://source.unsplash.com/400x300/?embryology,hypoblast+cells,endoderm",
                type: "estructura", chapter: "Cap√≠tulo 4", importance: "Alta",
                keywords: ["hipoblasto", "saco vitelino", "membrana exocel√≥mica", "endodermo extraembrionario"]
            },
            { 
                id: 103, name: "Saco vitelino terciario",
                description: "Tambi√©n conocido como saco vitelino definitivo. Es la evoluci√≥n final del saco vitelino secundario, m√°s peque√±o y conectado al intestino primitivo medio a trav√©s del conducto vitelino. Ayuda en la formaci√≥n de vasos vitelinos y puede persistir como el divert√≠culo de Meckel.",
                image: "https://source.unsplash.com/400x300/?embryology,definitive+yolk+sac,gut+development",
                type: "estructura", chapter: "Cap√≠tulo 4 (conectado a Sem 3)", importance: "Media",
                keywords: ["intestino primitivo", "conducto vitelino", "vasos vitelinos", "divert√≠culo de Meckel"]
            },
            {
                id: 104, name: "Implantaci√≥n an√≥mala", 
                description: "Ubicaci√≥n incorrecta del blastocisto durante la implantaci√≥n, como en la parte inferior del √∫tero (llevando a placenta previa) o fuera del √∫tero (embarazo ect√≥pico).",
                image: "https://source.unsplash.com/400x300/?medical,pregnancy,abnormal+implantation",
                type: "patologia", chapter: "Cap√≠tulo 4", importance: "Cr√≠tica",
                keywords: ["blastocisto", "placenta previa", "embarazo ect√≥pico", "sitio incorrecto"]
            },
            {
                id: 105, name: "Placenta previa", 
                description: "Implantaci√≥n del blastocisto en la parte inferior del √∫tero, de modo que la placenta cubre parcial o totalmente el orificio cervical interno.",
                image: "https://source.unsplash.com/400x300/?medical,pregnancy,placenta+previa",
                type: "patologia", chapter: "Cap√≠tulo 4", importance: "Alta",
                keywords: ["implantaci√≥n baja", "c√©rvix", "sangrado obst√©trico"]
            },
            {
                id: 106, name: "Amnios displ√°sico", 
                description: "Malformaciones en la formaci√≥n o estructura de la cavidad amni√≥tica o la membrana amni√≥tica.",
                image: "https://source.unsplash.com/400x300/?medical,embryology,amniotic+sac+abnormality",
                type: "patologia", chapter: "Cap√≠tulo 4", importance: "Media",
                keywords: ["cavidad amni√≥tica", "membrana amni√≥tica", "malformaci√≥n"]
            },
            {
                id: 107, name: "Hipoplasia del saco vitelino", 
                description: "Desarrollo reducido o insuficiente del saco vitelino, lo que puede comprometer el soporte temprano del embri√≥n.",
                image: "https://source.unsplash.com/400x300/?medical,embryology,yolk+sac+hypoplasia",
                type: "patologia", chapter: "Cap√≠tulo 4", importance: "Media",
                keywords: ["saco vitelino reducido", "soporte embrionario deficiente"]
            },
            {
                id: 108, name: "Alteraci√≥n del mesodermo extraembrionario", 
                description: "Malformaciones en el desarrollo del mesodermo extraembrionario, lo que puede afectar la formaci√≥n del corion, la cavidad cori√≥nica y los vasos sangu√≠neos tempranos.",
                image: "https://source.unsplash.com/400x300/?medical,embryology,mesoderm+abnormality",
                type: "patologia", chapter: "Cap√≠tulo 4", importance: "Alta",
                keywords: ["mesodermo extraembrionario", "corion", "cavidad cori√≥nica", "malformaci√≥n vascular"]
            },
            {
                id: 109, name: "Ausencia de cavidad cori√≥nica", 
                description: "Falla en la formaci√≥n o segmentaci√≥n del mesodermo extraembrionario que impide la creaci√≥n de la cavidad cori√≥nica.",
                image: "https://source.unsplash.com/400x300/?medical,embryology,chorionic+cavity+absence",
                type: "patologia", chapter: "Cap√≠tulo 4", importance: "Alta",
                keywords: ["cavidad cori√≥nica ausente", "mesodermo extraembrionario", "falla desarrollo"]
            },
            {
                id: 110, name: "Adherencias anormales del sincitio", 
                description: "Invasi√≥n excesiva del sincitiotrofoblasto en la pared uterina, m√°s all√° del endometrio, pudiendo llegar al miometrio (placenta accreta) o incluso atravesarlo (placenta percreta).",
                image: "https://source.unsplash.com/400x300/?medical,pregnancy,placenta+accreta",
                type: "patologia", chapter: "Cap√≠tulo 4", importance: "Cr√≠tica",
                keywords: ["sincitiotrofoblasto", "placenta accreta", "placenta percreta", "invasi√≥n uterina"]
            },
            
            // Cap√≠tulo 5: Tercera semana del desarrollo (Nuevos perfiles IDs 111-138)
            // Estr√≠a Primitiva (ID 33) se actualiza en KB, no se crea nuevo perfil. L√≠nea Primitiva es alias.
            {
                id: 111, name: "Nodo primitivo",
                description: "Estructura en el extremo cef√°lico de la estr√≠a primitiva. Controla la migraci√≥n y diferenciaci√≥n celular. Dirige el desarrollo axial.",
                image: "https://source.unsplash.com/400x300/?embryology,primitive+node,gastrulation",
                type: "estructura", chapter: "Cap√≠tulo 5", importance: "Cr√≠tica",
                keywords: ["estr√≠a primitiva", "notocorda", "desarrollo axial", "gastrulaci√≥n", "inducci√≥n"]
            },
            {
                id: 112, name: "Fosa primitiva",
                description: "Depresi√≥n en el nodo primitivo. Sitio de ingreso celular hacia el mesodermo axial e inicio del canal notocordal.",
                image: "https://source.unsplash.com/400x300/?embryology,primitive+pit,notochord+development",
                type: "estructura", chapter: "Cap√≠tulo 5", importance: "Alta",
                keywords: ["nodo primitivo", "canal notocordal", "invaginaci√≥n celular", "mesodermo axial"]
            },
            {
                id: 113, name: "Canal notocordal",
                description: "Conducto temporal formado por c√©lulas invaginadas desde la fosa primitiva. Se convertir√° en notocorda definitiva y dirige la inducci√≥n del tubo neural.",
                image: "https://source.unsplash.com/400x300/?embryology,notochordal+canal,notogenesis",
                type: "estructura", chapter: "Cap√≠tulo 5", importance: "Alta",
                keywords: ["fosa primitiva", "notocorda", "tubo neural", "inducci√≥n"]
            },
            {
                id: 114, name: "Notocorda",
                description: "Cilindro mesod√©rmico axial. Induce la formaci√≥n del tubo neural y es el eje estructural embrionario.",
                image: "https://source.unsplash.com/400x300/?embryology,notochord,axial+skeleton",
                type: "estructura", chapter: "Cap√≠tulo 5", importance: "Cr√≠tica",
                keywords: ["eje axial", "inducci√≥n neural", "ectodermo", "somitas", "mesodermo"]
            },
            {
                id: 115, name: "Endodermo embrionario",
                description: "Capa germinal interna derivada del epiblasto durante la gastrulaci√≥n. Formar√° el tubo digestivo y gl√°ndulas asociadas.",
                image: "https://source.unsplash.com/400x300/?embryology,endoderm,germ+layer,digestive+system",
                type: "estructura", chapter: "Cap√≠tulo 5", importance: "Cr√≠tica",
                keywords: ["gastrulaci√≥n", "epiblasto", "tubo digestivo", "revestimiento √≥rganos", "capa germinal"]
            },
            {
                id: 116, name: "Mesodermo embrionario",
                description: "Capa germinal media, situada entre ectodermo y endodermo, originada del epiblasto. Formar√° m√∫sculo, hueso, sangre y m√°s.",
                image: "https://source.unsplash.com/400x300/?embryology,mesoderm,germ+layer,muscle,bone",
                type: "estructura", chapter: "Cap√≠tulo 5", importance: "Cr√≠tica",
                keywords: ["gastrulaci√≥n", "epiblasto", "somitas", "m√∫sculo", "hueso", "sangre", "capa germinal"]
            },
            {
                id: 117, name: "Ectodermo embrionario",
                description: "Capa germinal superior derivada del epiblasto tras la gastrulaci√≥n. Formar√° la piel, el sistema nervioso y √≥rganos sensoriales.",
                image: "https://source.unsplash.com/400x300/?embryology,ectoderm,germ+layer,nervous+system,skin",
                type: "estructura", chapter: "Cap√≠tulo 5", importance: "Cr√≠tica",
                keywords: ["gastrulaci√≥n", "epiblasto", "piel", "sistema nervioso", "SNC", "capa germinal"]
            },
            {
                id: 118, name: "Placa precordal",
                description: "Grupo de c√©lulas mesod√©rmicas situadas entre el extremo cef√°lico de la notocorda y la membrana bucofar√≠ngea. Induce al enc√©falo y gu√≠a el desarrollo cef√°lico.",
                image: "https://source.unsplash.com/400x300/?embryology,prechordal+plate,brain+development,head+organizer",
                type: "estructura", chapter: "Cap√≠tulo 5", importance: "Alta",
                keywords: ["notocorda", "membrana bucofar√≠ngea", "inducci√≥n enc√©falo", "desarrollo cef√°lico", "organizador"]
            },
            {
                id: 119, name: "Membrana bucofar√≠ngea",
                description: "√Årea bilaminar (ectodermo y endodermo fusionados, sin mesodermo interpuesto) en la regi√≥n cef√°lica, que marca el sitio futuro de la boca. Delimita la regi√≥n cef√°lica anterior.",
                image: "https://source.unsplash.com/400x300/?embryology,oropharyngeal+membrane,buccopharyngeal",
                type: "estructura", chapter: "Cap√≠tulo 5", importance: "Alta",
                keywords: ["ectodermo", "endodermo", "futura boca", "estomodeo", "regi√≥n cef√°lica"]
            },
            {
                id: 120, name: "Membrana cloacal",
                description: "√Årea bilaminar (ectodermo y endodermo fusionados, sin mesodermo) en la regi√≥n caudal del embri√≥n. Marca el sitio futuro del ano y es un cierre temporal de la regi√≥n anal.",
                image: "https://source.unsplash.com/400x300/?embryology,cloacal+membrane,anus",
                type: "estructura", chapter: "Cap√≠tulo 5", importance: "Alta",
                keywords: ["ectodermo", "endodermo", "futuro ano", "regi√≥n caudal", "intestino posterior"]
            },
            {
                id: 121, name: "Alantoides",
                description: "Peque√±a evaginaci√≥n del endodermo del saco vitelino que se extiende hacia el ped√≠culo de fijaci√≥n. Participa en la formaci√≥n del cord√≥n umbilical, vasos umbilicales y la vejiga urinaria (uraco).",
                image: "https://source.unsplash.com/400x300/?embryology,allantois,umbilical+vessels",
                type: "estructura", chapter: "Cap√≠tulo 5", importance: "Media",
                keywords: ["saco vitelino", "ped√≠culo de fijaci√≥n", "cord√≥n umbilical", "vejiga", "uraco", "vasos umbilicales"]
            },
            {
                id: 122, name: "Mesodermo paraxial",
                description: "Regi√≥n del mesodermo embrionario que se organiza en columnas longitudinales a cada lado de la notocorda. Se segmenta para formar los somitas, que originan v√©rtebras y m√∫sculos.",
                image: "https://source.unsplash.com/400x300/?embryology,paraxial+mesoderm,somite+formation",
                type: "estructura", chapter: "Cap√≠tulo 5", importance: "Cr√≠tica",
                keywords: ["mesodermo", "notocorda", "somitas", "esqueleto axial", "m√∫sculos", "segmentaci√≥n"]
            },
            {
                id: 123, name: "Mesodermo intermedio",
                description: "Regi√≥n del mesodermo embrionario situada entre el mesodermo paraxial y el mesodermo lateral. Forma estructuras del sistema urogenital, participando en ri√±ones y g√≥nadas.",
                image: "https://source.unsplash.com/400x300/?embryology,intermediate+mesoderm,urogenital",
                type: "estructura", chapter: "Cap√≠tulo 5", importance: "Alta",
                keywords: ["mesodermo", "sistema urogenital", "ri√±ones", "g√≥nadas", "nefr√≥tomos"]
            },
            {
                id: 124, name: "Mesodermo lateral",
                description: "Regi√≥n m√°s externa del mesodermo embrionario que se divide en dos hojas: la somatopleura (parietal) y la esplacnopleura (visceral), delimitando el celoma intraembrionario (futuras cavidades corporales).",
                image: "https://source.unsplash.com/400x300/?embryology,lateral+plate+mesoderm,body+cavities",
                type: "estructura", chapter: "Cap√≠tulo 5", importance: "Alta",
                keywords: ["mesodermo", "cavidades corporales", "somatopleura", "esplacnopleura", "serosas", "celoma"]
            },
            {
                id: 125, name: "Somatopleura",
                description: "Capa formada por la asociaci√≥n del mesodermo lateral parietal y el ectodermo suprayacente. Forma la dermis de la pared corporal, huesos de las extremidades y revestimiento parietal de las cavidades corporales.",
                image: "https://source.unsplash.com/400x300/?embryology,somatopleure,body+wall+formation",
                type: "estructura", chapter: "Cap√≠tulo 5", importance: "Media",
                keywords: ["mesodermo lateral", "ectodermo", "pared corporal", "dermis", "extremidades", "revestimiento parietal"]
            },
            {
                id: 126, name: "Esplacnopleura", 
                description: "Capa formada por la asociaci√≥n del mesodermo lateral visceral y el endodermo subyacente. Forma la musculatura lisa y el tejido conectivo del tubo digestivo, as√≠ como el revestimiento visceral de las cavidades corporales y los mesenterios.",
                image: "https://source.unsplash.com/400x300/?embryology,splanchnopleure,visceral+mesoderm,gut+muscle",
                type: "estructura", chapter: "Cap√≠tulo 5", importance: "Media",
                keywords: ["mesodermo lateral", "endodermo", "tubo digestivo", "m√∫sculo liso", "mesenterios", "revestimiento visceral"]
            },
            {
                id: 127, name: "Somitas",
                description: "Bloques segmentados de mesodermo paraxial que se forman a ambos lados del tubo neural. Dan origen a v√©rtebras, costillas, m√∫sculos axiales y dermis dorsal.",
                image: "https://source.unsplash.com/400x300/?embryology,somites,segmentation,vertebrae",
                type: "estructura", chapter: "Cap√≠tulo 5", importance: "Cr√≠tica",
                keywords: ["mesodermo paraxial", "segmentaci√≥n", "v√©rtebras", "m√∫sculos", "dermis", "esclerotoma", "miotoma", "dermatoma"]
            },
            {
                id: 128, name: "Canal neurent√©rico",
                description: "Comunicaci√≥n temporal y transitoria que se establece entre la cavidad amni√≥tica y el saco vitelino a trav√©s de la fosa primitiva y el proceso notocordal. Permite el paso de l√≠quido.",
                image: "https://source.unsplash.com/400x300/?embryology,neurenteric+canal,notochordal+process",
                type: "estructura", chapter: "Cap√≠tulo 5", importance: "Baja",
                keywords: ["cavidad amni√≥tica", "saco vitelino", "fosa primitiva", "notocorda", "comunicaci√≥n temporal"]
            },
            // Patolog√≠as Cap√≠tulo 5
            {
                id: 129, name: "Teratomas sacrococc√≠geos", 
                description: "Tumores que se originan de remanentes de la estr√≠a primitiva en la regi√≥n sacrococc√≠gea. Pueden contener tejidos de las tres capas germinativas.",
                image: "https://source.unsplash.com/400x300/?medical,sacrococcygeal+teratoma,newborn+tumor",
                type: "patologia", chapter: "Cap√≠tulo 5", importance: "Alta",
                keywords: ["teratoma", "estr√≠a primitiva", "regi√≥n sacrococc√≠gea", "tumor cong√©nito", "c√©lulas pluripotentes"]
            },
            {
                id: 130, name: "Gastrulaci√≥n incompleta",
                description: "Falla en la correcta formaci√≥n o migraci√≥n de las c√©lulas a trav√©s de la estr√≠a primitiva, resultando en una deficiente formaci√≥n de una o m√°s capas germinativas (endodermo, mesodermo, ectodermo).",
                image: "https://source.unsplash.com/400x300/?medical,embryology,incomplete+gastrulation,birth+defect",
                type: "patologia", chapter: "Cap√≠tulo 5", importance: "Cr√≠tica",
                keywords: ["gastrulaci√≥n", "capas germinativas", "migraci√≥n celular", "malformaciones severas", "estr√≠a primitiva"]
            },
            {
                id: 131, name: "Defectos de notocorda",
                description: "Anomal√≠as en la formaci√≥n, estructura o funci√≥n de la notocorda. Pueden llevar a malformaciones del eje axial (columna vertebral) y defectos en la inducci√≥n del sistema nervioso central.",
                image: "https://source.unsplash.com/400x300/?medical,embryology,notochord+defect,spina+bifida",
                type: "patologia", chapter: "Cap√≠tulo 5", importance: "Alta",
                keywords: ["notocorda", "eje axial", "columna vertebral", "inducci√≥n neural", "tubo neural"]
            },
            {
                id: 132, name: "Situs inversus",
                description: "Condici√≥n en la que los √≥rganos internos tor√°cicos y abdominales est√°n en una disposici√≥n en espejo de la normal (ej. coraz√≥n a la derecha, h√≠gado a la izquierda). Se relaciona con alteraciones en la funci√≥n de los cilios del nodo primitivo.",
                image: "https://source.unsplash.com/400x300/?medical,anatomy,situs+inversus,organ+transposition",
                type: "patologia", chapter: "Cap√≠tulo 5", importance: "Media",
                keywords: ["lateralidad corporal", "√≥rganos invertidos", "nodo primitivo", "cilios", "gen√©tica"]
            },
            {
                id: 133, name: "Agenesia de somitas",
                description: "Ausencia de formaci√≥n de uno o m√°s somitas, lo que resulta en la falta de desarrollo de las estructuras derivadas de ellos, como v√©rtebras, costillas o m√∫sculos segmentarios.",
                image: "https://source.unsplash.com/400x300/?medical,embryology,somite+agenesis,vertebral+defect",
                type: "patologia", chapter: "Cap√≠tulo 5", importance: "Alta",
                keywords: ["somitas", "formaci√≥n vertebral", "ausencia estructuras", "desarrollo axial", "mesodermo paraxial"]
            },
            {
                id: 134, name: "Defectos del mesodermo lateral",
                description: "Malformaciones en el desarrollo del mesodermo lateral, que pueden afectar la formaci√≥n de las cavidades corporales (celoma), el coraz√≥n, el sistema cardiovascular, las extremidades y las serosas (pleura, pericardio, peritoneo).",
                image: "https://source.unsplash.com/400x300/?medical,embryology,lateral+mesoderm+defect,heart+defect",
                type: "patologia", chapter: "Cap√≠tulo 5", importance: "Alta",
                keywords: ["mesodermo lateral", "cavidades corporales", "coraz√≥n", "malformaciones cardiovasculares", "extremidades"]
            },
            {
                id: 135, name: "Anomal√≠as cloacales",
                description: "Defectos en la partici√≥n o desarrollo de la cloaca (estructura com√∫n para los sistemas digestivo, urinario y genital en etapas tempranas), o persistencia de la membrana cloacal. Puede resultar en malformaciones anorrectales y urogenitales complejas.",
                image: "https://source.unsplash.com/400x300/?medical,embryology,cloacal+malformation,urogenital+defect",
                type: "patologia", chapter: "Cap√≠tulo 5", importance: "Alta",
                keywords: ["cloaca", "membrana cloacal", "malformaciones anorrectales", "malformaciones urogenitales", "septo urorrectal"]
            },
            {
                id: 136, name: "F√≠stula alantoidea (uracal)",
                description: "Persistencia del uraco, un conducto que conecta la vejiga fetal con el ombligo a trav√©s del alantoides. Si permanece permeable despu√©s del nacimiento, puede causar una f√≠stula uracal (drenaje de orina por el ombligo), quiste uracal o seno uracal.",
                image: "https://source.unsplash.com/400x300/?medical,pediatrics,urachal+fistula,umbilicus",
                type: "patologia", chapter: "Cap√≠tulo 5", importance: "Media",
                keywords: ["alantoides", "uraco", "vejiga", "ombligo", "f√≠stula", "quiste uracal"]
            },
            {
                id: 137, name: "Duplicaci√≥n del nodo primitivo",
                description: "Presencia de dos nodos primitivos, lo que puede llevar a la formaci√≥n de dos ejes embrionarios y, en consecuencia, a la duplicaci√≥n de estructuras axiales o incluso a gemelos siameses.",
                image: "https://source.unsplash.com/400x300/?medical,embryology,conjoined+twins,primitive+node+duplication",
                type: "patologia", chapter: "Cap√≠tulo 5", importance: "Cr√≠tica",
                keywords: ["nodo primitivo duplicado", "eje embrionario", "gemelos siameses", "duplicaci√≥n estructuras", "gastrulaci√≥n an√≥mala"]
            },
            {
                id: 138, name: "Mesodermo paraxial hipopl√°sico",
                description: "Desarrollo reducido o insuficiente del mesodermo paraxial, lo que resulta en una formaci√≥n deficiente de somitas y, por lo tanto, en anomal√≠as del esqueleto axial (v√©rtebras, costillas) y de la musculatura asociada.",
                image: "https://source.unsplash.com/400x300/?medical,embryology,paraxial+mesoderm+hypoplasia,skeletal+abnormality",
                type: "patologia", chapter: "Cap√≠tulo 5", importance: "Alta",
                keywords: ["mesodermo paraxial", "hipoplasia", "somitas deficientes", "desarrollo √≥seo-muscular reducido", "esqueleto axial"]
            }
        ];

        let currentCardIndex = 0;
        let matches = [];
        let currentChatProfile = null;
        let chatMessages = {}; 
        let isDragging = false;
        let isTyping = false; 

        const cardsContainer = document.getElementById('cards-container');
        const emptySwipeState = cardsContainer.querySelector('.empty-state');
        const aiTypingIndicatorTemplate = document.getElementById('ai-typing-indicator-template');


        function init() {
            loadCards();
            setupEventListeners();
            loadMatches(); 
            updateActionButtonsState();
        }

        function setupEventListeners() {
            const messageInput = document.getElementById('message-input');
            if (messageInput) {
                messageInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) { 
                        e.preventDefault();
                        sendMessage();
                    }
                });
            }
            profiles.forEach(profile => {
                const img = new Image();
                img.src = profile.image; 
            });
        }

        function updateActionButtonsState() {
            const actionButtons = document.querySelector('.action-buttons');
            if (currentCardIndex >= profiles.length) {
                if(actionButtons) actionButtons.style.display = 'none';
            } else {
                if(actionButtons) actionButtons.style.display = 'flex';
            }
        }

        function loadCards() {
            Array.from(cardsContainer.querySelectorAll('.card')).forEach(card => card.remove());

            if (currentCardIndex >= profiles.length) {
                if(emptySwipeState) emptySwipeState.style.display = 'flex'; 
                updateActionButtonsState();
                return;
            }
            if(emptySwipeState) emptySwipeState.style.display = 'none'; 


            const cardsToShow = Math.min(3, profiles.length - currentCardIndex);
            for (let i = cardsToShow - 1; i >= 0; i--) {
                if (currentCardIndex + i < profiles.length) {
                    const profile = profiles[currentCardIndex + i];
                    const card = createCard(profile, i);
                    cardsContainer.appendChild(card);
                }
            }
            updateActionButtonsState();
        }
        
        function createCard(profile, stackIndex) {
            const cardElement = document.createElement('div');
            cardElement.className = 'card';
            cardElement.style.zIndex = profiles.length - currentCardIndex - stackIndex; 
            cardElement.style.transform = `scale(${1 - stackIndex * 0.04}) translateY(${stackIndex * -8}px)`;
            cardElement.style.opacity = stackIndex === 0 ? 1 : (1 - (stackIndex * 0.3));
            
            // Mostrar solo la primera oraci√≥n de la descripci√≥n en la tarjeta
            const firstSentence = profile.description.split('.')[0] + '.';

            cardElement.innerHTML = `
                <img src="${profile.image}" alt="Imagen de ${profile.name}" onerror="this.src='https://via.placeholder.com/400x300/e0e0e0/999999?text=Imagen+no+disponible'; this.alt='Imagen no disponible para ${profile.name}';">
                <div class="card-info">
                    <h3>
                        ${profile.name}
                        <span class="profile-badge badge-${profile.type === 'proceso' ? 'proceso' : profile.type}">
                            ${profile.type}
                        </span>
                    </h3>
                    <p>${firstSentence}</p>
                    <div class="card-stats">
                        <span>üìö ${profile.chapter}</span>
                        <span>‚≠ê ${profile.importance}</span>
                    </div>
                </div>
            `;
            
            if (stackIndex === 0) { 
                addSwipeListeners(cardElement);
            }
            
            return cardElement;
        }

        function addSwipeListeners(cardElement) {
            let startX, startY, currentX, currentY, isPointerDown = false;

            function pointerDown(e) {
                isPointerDown = true;
                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
                startY = e.type.includes('mouse') ? e.clientY : e.touches[0].clientY;
                currentX = 0; 
                currentY = 0; 
                cardElement.classList.add('dragging');
                if (e.type === 'touchstart' && e.currentTarget === cardElement) { 
                    document.addEventListener('touchmove', pointerMove, { passive: false });
                    document.addEventListener('touchend', pointerUp);
                } else if (e.type === 'mousedown') {
                    document.addEventListener('mousemove', pointerMove);
                    document.addEventListener('mouseup', pointerUp);
                }
            }

            function pointerMove(e) {
                if (!isPointerDown) return;
                if (e.type === 'touchmove') e.preventDefault(); 

                currentX = (e.type.includes('mouse') ? e.clientX : e.touches[0].clientX) - startX;
                currentY = (e.type.includes('mouse') ? e.clientY : e.touches[0].clientY) - startY;
                
                const rotation = currentX * 0.05; 
                cardElement.style.transform = `translate(${currentX}px, ${currentY}px) rotate(${rotation}deg)`;
            }

            function pointerUp(e) { 
                if (!isPointerDown) return;
                isPointerDown = false;
                cardElement.classList.remove('dragging');

                if (e.type === 'touchend') {
                    document.removeEventListener('touchmove', pointerMove);
                    document.removeEventListener('touchend', pointerUp);
                } else if (e.type === 'mouseup') {
                    document.removeEventListener('mousemove', pointerMove);
                    document.removeEventListener('mouseup', pointerUp);
                }

                const decisionThresholdX = cardElement.offsetWidth * 0.3; 
                const decisionThresholdY = cardElement.offsetHeight * 0.2; 

                if (Math.abs(currentX) > decisionThresholdX || Math.abs(currentY) > decisionThresholdY) {
                     if (currentY < -decisionThresholdY && Math.abs(currentX) < decisionThresholdX * 1.5) { 
                        handleSwipeAction(cardElement, 'super-like-animation', superLikeCard);
                    } else if (currentX > decisionThresholdX) { 
                        handleSwipeAction(cardElement, 'swipe-right', likeCard);
                    } else if (currentX < -decisionThresholdX) { 
                        handleSwipeAction(cardElement, 'swipe-left', rejectCard);
                    } else {
                         resetCardPosition(cardElement); 
                    }
                } else {
                    resetCardPosition(cardElement);
                }
            }
            
            cardElement.addEventListener('mousedown', pointerDown);
            cardElement.addEventListener('touchstart', pointerDown, { passive: false });
        }

        function resetCardPosition(cardElement) {
            cardElement.style.transition = 'transform 0.3s ease-out';
            cardElement.style.transform = `scale(1) translateY(0px)`; 
            setTimeout(() => {
                 cardElement.style.transition = ''; 
            }, 300);
        }

        function handleSwipeAction(cardElement, animationClass, actionCallback) {
            if (!cardElement) return; 
            cardElement.style.transition = 'none'; 
            cardElement.classList.add(animationClass);
            
            setTimeout(() => {
                actionCallback(); 
                if(cardElement.parentNode) cardElement.remove(); 
                currentCardIndex++;
                loadCards(); 
            }, 500); 
        }
        
        function rejectCardManual() {
            const cardElement = cardsContainer.querySelector('.card:last-of-type'); 
            if (cardElement && !isDragging) handleSwipeAction(cardElement, 'swipe-left', rejectCard);
        }
        function likeCardManual() {
            const cardElement = cardsContainer.querySelector('.card:last-of-type');
            if (cardElement && !isDragging) handleSwipeAction(cardElement, 'swipe-right', likeCard);
        }
        function superLikeCardManual() {
            const cardElement = cardsContainer.querySelector('.card:last-of-type');
            if (cardElement && !isDragging) handleSwipeAction(cardElement, 'super-like-animation', superLikeCard);
        }

        function rejectCard() {
            // console.log("Rejected profile ID:", profiles[currentCardIndex]?.id, profiles[currentCardIndex]?.name);
        }

        function likeCard() {
            const profile = profiles[currentCardIndex];
            if (profile && Math.random() > 0.3) { 
                createMatch(profile);
                showMatchPopup(profile.name);
            }
            // console.log("Liked profile ID:", profile?.id, profile?.name);
        }

        function superLikeCard() {
            const profile = profiles[currentCardIndex];
            if (profile) {
                createMatch(profile);
                showMatchPopup(profile.name, true);
            }
            // console.log("SuperLiked profile ID:", profile?.id, profile?.name);
        }
        
        function showMatchPopup(profileName, isSuperLike = false) {
            const popup = document.getElementById('match-popup');
            const messageElement = document.getElementById('match-message');
            if (isSuperLike) {
                messageElement.textContent = `¬°Es un Super Match con ${profileName}! ‚ú® Ahora pueden chatear.`;
                popup.querySelector('h2').textContent = '¬°Super Match! üåü';
            } else {
                messageElement.textContent = `¬°Hiciste Match con ${profileName}! Ahora pueden chatear.`;
                popup.querySelector('h2').textContent = '¬°Es un Match! üéâ';
            }
            popup.style.display = 'flex';
        }

        function createMatch(profile) {
            if (!matches.find(m => m.id === profile.id)) {
                matches.push({ ...profile, matchedAt: new Date() });
                loadMatches(); 
            }
        }

        function loadMatches() {
            const container = document.getElementById('matches-grid');
            const emptyStateMatches = container.querySelector('.empty-state');

            if (matches.length === 0) {
                if (emptyStateMatches) emptyStateMatches.style.display = 'flex';
                Array.from(container.querySelectorAll('.match-card')).forEach(card => card.remove());
                return;
            }
            
            if(emptyStateMatches) emptyStateMatches.style.display = 'none';
            container.innerHTML = ''; 
            matches.sort((a,b) => b.matchedAt - a.matchedAt);

            matches.forEach(match => {
                const card = document.createElement('div');
                card.className = 'match-card';
                card.onclick = () => openChat(match);
                card.innerHTML = `
                    <img src="${match.image}" alt="Imagen de ${match.name}" onerror="this.src='https://via.placeholder.com/150x100/e0e0e0/999999?text=Error'; this.alt='Imagen no disponible para ${match.name}';">
                    <div class="match-info">
                        <h4>${match.name}</h4>
                        <p>${match.type} - ${match.chapter}</p>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function openChat(profile) {
            currentChatProfile = profile;
            switchTab('chat', document.querySelector('.nav-tabs button:nth-child(3)')); 
            
            const chatHeader = document.getElementById('chat-header');
            const chatInput = document.getElementById('chat-input');
            const chatAvatar = document.getElementById('chat-avatar');
            const chatName = document.getElementById('chat-name');
            
            if(chatHeader) chatHeader.style.display = 'flex';
            if(chatInput) chatInput.style.display = 'flex';
            if(chatAvatar) {
                chatAvatar.src = profile.image;
                chatAvatar.onerror = function() { this.src='https://via.placeholder.com/40/e0e0e0/999999?text=N/A'; this.alt='Avatar no disponible';};
            }
            if(chatName) chatName.textContent = profile.name;
            
            const chatMessagesContainer = document.getElementById('chat-messages');
            const emptyChatState = chatMessagesContainer.querySelector('.empty-state');
            if(emptyChatState) emptyChatState.style.display = 'none';


            if (!chatMessages[profile.id]) {
                 const firstSentenceDesc = profile.description.split('.')[0] + '.';
                chatMessages[profile.id] = [{
                    sender: 'ai',
                    text: `¬°Hola! Soy ${profile.name}. ${firstSentenceDesc} ¬øQu√© te gustar√≠a saber sobre m√≠, por ejemplo, mi funci√≥n, estructura, importancia, semana de aparici√≥n o mi relaci√≥n con otros elementos del ${profile.chapter}?`
                }];
            }
            loadChatMessages();
        }

        function loadChatMessages() {
            const container = document.getElementById('chat-messages');
            if (!currentChatProfile) {
                if (!container.querySelector('.empty-state')) {
                    container.innerHTML = '<div class="empty-state"><h3>Selecciona un match</h3><p>Elige un match para empezar a chatear</p></div>';
                } else {
                    const es = container.querySelector('.empty-state');
                    if(es) es.style.display = 'flex';
                }
                const chatHeader = document.getElementById('chat-header');
                const chatInput = document.getElementById('chat-input');
                if(chatHeader) chatHeader.style.display = 'none';
                if(chatInput) chatInput.style.display = 'none';
                return;
            }
            
            const emptyChatState = container.querySelector('.empty-state');
            if (emptyChatState) emptyChatState.style.display = 'none';

            container.innerHTML = ''; 
            const messages = chatMessages[currentChatProfile.id] || [];
            
            messages.forEach(msg => {
                const div = document.createElement('div');
                div.className = `message ${msg.sender}`;
                div.textContent = msg.text;
                container.appendChild(div);
            });
            
            if (isTyping) {
                const indicator = aiTypingIndicatorTemplate.cloneNode(true);
                indicator.id = ''; 
                indicator.style.display = 'flex';
                container.appendChild(indicator);
            }
            container.scrollTop = container.scrollHeight;
        }
        
        function generateAIResponse(userMessage, profile) {
            const message = userMessage.toLowerCase();
            const knowledgeBase = {
                // CAP√çTULO 1
                cromatina: {
                    definici√≥n: "Soy la estructura fundamental del n√∫cleo celular, compuesta por ADN enrollado alrededor de prote√≠nas histonas. Mi principal funci√≥n es empaquetar el largo ADN de forma organizada dentro del n√∫cleo y regular la expresi√≥n g√©nica. ",
                    funci√≥n_principal: "Organizo y regulo el acceso al ADN. Controlo qu√© genes se expresan empaquetando el ADN de forma din√°mica. Puedo estar en forma laxa (Eucromatina, activa para transcripci√≥n) o compacta (Heterocromatina, inactiva). ",
                    estructura: "Estoy formada por ADN enrollado alrededor de oct√°meros de prote√≠nas histonas (H2A, H2B, H3, H4), formando Nucleosomas, que son como 'cuentas en un collar'. La histona H1 ayuda a compactar m√°s este collar.",
                    importancia: "Sin m√≠, el ADN de ~2 metros no cabr√≠a en un n√∫cleo de ~10 micr√≥metros. Soy crucial para la divisi√≥n celular (formando cromosomas visibles) y para la regulaci√≥n epigen√©tica del desarrollo.",
                    relacion_funcional: "Los Nucleosomas son mi unidad b√°sica. La Metilaci√≥n del ADN y las modificaciones de histonas afectan mi estructura y funci√≥n, determinando si soy Eucromatina o Heterocromatina. Los Factores de transcripci√≥n interact√∫an conmigo para acceder a los Promotores g√©nicos.",
                    patolog√≠a: "Alteraciones en mi estructura o en las prote√≠nas asociadas pueden causar diversos trastornos del desarrollo y c√°ncer. Por ejemplo, mutaciones en genes que modifican histonas o leen la Metilaci√≥n del ADN (como en el S√≠ndrome de Rett )."
                },
                nucleosoma: {
                    definici√≥n: "Soy la unidad estructural b√°sica de la Cromatina en las c√©lulas eucariotas. Consisto en un segmento de ADN enrollado alrededor de un n√∫cleo de ocho prote√≠nas histonas (oct√°mero). Permito compactar el ADN y controlar su acceso. ",
                    funci√≥n_principal: "Soy el primer nivel de compactaci√≥n del ADN, permitiendo que el genoma quepa en el n√∫cleo. Tambi√©n juego un papel clave en la regulaci√≥n de la expresi√≥n g√©nica, ya que mi posici√≥n y las modificaciones de mis histonas pueden afectar el acceso de los Factores de transcripci√≥n y la ARN polimerasa al ADN.",
                    estructura: "Mi n√∫cleo est√° formado por dos copias de cada una de las cuatro histonas principales: H2A, H2B, H3 y H4. Alrededor de este oct√°mero se enrollan aproximadamente 147 pares de bases de ADN, dando casi dos vueltas. Un segmento de ADN espaciador (linker DNA) me conecta con el siguiente nucleosoma, y la histona H1 se asocia a este ADN espaciador para mayor compactaci√≥n.",
                    importancia: "Soy fundamental para organizar el genoma y para la regulaci√≥n epigen√©tica.",
                    relacion_funcional: "Soy la unidad repetitiva de la Cromatina. "
                },
                eucromatina: {
                    definici√≥n: "Soy una forma de Cromatina menos condensada y gen√©ticamente activa. Me encuentro dispersa en el nucleoplasma y permito la transcripci√≥n activa. ",
                    funci√≥n_principal: "Permito la transcripci√≥n de los genes que contengo, ya que mi estructura laxa hace que el ADN sea accesible a la maquinaria de transcripci√≥n, incluyendo la ARN polimerasa y los Factores de transcripci√≥n.",
                    estructura: "Me caracterizo por tener Nucleosomas m√°s espaciados y por modificaciones espec√≠ficas en las histonas, como la acetilaci√≥n de lisinas y la metilaci√≥n de lisina 4 en la histona H3 (H3K4me3), que promueven una estructura abierta.",
                    importancia: "Soy esencial para la expresi√≥n de genes necesarios para las funciones celulares y la diferenciaci√≥n durante el desarrollo.",
                    relacion_funcional: "Soy un estado de la Cromatina, opuesto a la Heterocromatina. La Metilaci√≥n del ADN suele ser baja en mis regiones. Interact√∫o activamente con Factores de transcripci√≥n  y Potenciadores."
                },
                heterocromatina: {
                    definici√≥n: "Soy una forma de Cromatina altamente condensada y gen√©ticamente inactiva o reprimida que impide la transcripci√≥n.  A menudo me localizo en la periferia del n√∫cleo y alrededor del nucl√©olo.",
                    funci√≥n_principal: "Mi principal funci√≥n es mantener genes en estado silenciado y proteger la integridad de regiones cromos√≥micas estructuralmente importantes como los centr√≥meros y tel√≥meros. Tambi√©n participo en la organizaci√≥n nuclear.",
                    estructura: "Me caracterizo por una densa compactaci√≥n de Nucleosomas. Mis histonas suelen tener modificaciones represivas, como la metilaci√≥n de lisina 9 (H3K9me3) y lisina 27 (H3K27me3) en la histona H3, y mi ADN suele estar altamente metilado (ver Metilaci√≥n del ADN).",
                    tipos: "Existo en dos formas principales: constitutiva (permanentemente condensada y con secuencias repetitivas) y facultativa (puede cambiar su estado de condensaci√≥n seg√∫n el tipo celular o el desarrollo, silenciando genes espec√≠ficos de tejido).",
                    importancia: "Soy crucial para la estabilidad gen√≥mica, el silenciamiento de elementos transponibles y la correcta regulaci√≥n de la expresi√≥n g√©nica durante el desarrollo y la diferenciaci√≥n celular.",
                    relacion_funcional: "Soy un estado de la Cromatina, opuesto a la Eucromatina. La Metilaci√≥n del ADN y prote√≠nas espec√≠ficas lectoras de estas marcas contribuyen a mi formaci√≥n y mantenimiento."
                },
                promotor: {
                    definici√≥n: "Soy una regi√≥n espec√≠fica del ADN localizada al inicio de un gen, donde se une la ARN polimerasa y los Factores de transcripci√≥n generales para iniciar la transcripci√≥n de ese gen. ",
                    funci√≥n_principal: "Mi funci√≥n es dirigir el inicio de la transcripci√≥n. Controlo cu√°ndo y con qu√© frecuencia se transcribe un gen. Act√∫o como un interruptor molecular.",
                    estructura: "Contengo secuencias consenso importantes, como la Caja TATA  en muchos genes eucariotas, as√≠ como otros elementos reguladores proximales donde se unen Factores de transcripci√≥n espec√≠ficos.",
                    importancia: "Soy esencial para la expresi√≥n g√©nica. Mutaciones en mi secuencia pueden alterar dr√°sticamente la expresi√≥n de un gen, llevando a enfermedades como el c√°ncer. ",
                    relacion_funcional: "La ARN polimerasa se une a m√≠, ayudada por Factores de transcripci√≥n. Mi actividad puede ser modulada por Potenciadores y Silenciadores."
                },
                "caja tata": {
                    definici√≥n: "Soy una secuencia de ADN consenso (t√≠picamente TATAAA) que se encuentra en la regi√≥n promotora de muchos genes eucariotas, donde se une la ARN polimerasa con ayuda de factores de transcripci√≥n. ",
                    funci√≥n_principal: "Juego un papel crucial en el ensamblaje del complejo de preiniciaci√≥n de la transcripci√≥n. Soy el sitio de uni√≥n para el factor de transcripci√≥n general TBP (TATA-binding protein), que es una subunidad de TFIID. Esta uni√≥n ayuda a posicionar correctamente la ARN polimerasa II en el Promotor.",
                    importancia: "Soy un elemento central para la iniciaci√≥n precisa de la transcripci√≥n en una gran cantidad de genes.",
                    relacion_funcional: "Soy una parte clave del Promotor de muchos genes. Interact√∫o directamente con Factores de transcripci√≥n (espec√≠ficamente TBP/TFIID) para ayudar a la ARN polimerasa a iniciar la transcripci√≥n gen√©tica. "
                },
                "factores de transcripci√≥n": {
                    definici√≥n: "Somos prote√≠nas que nos unimos a secuencias espec√≠ficas de ADN para regular la expresi√≥n gen√©tica activando o inhibiendo genes. ",
                    funci√≥n_principal: "Controlamos qu√© genes se activan o reprimen en una c√©lula en un momento dado. Somos esenciales para la diferenciaci√≥n celular, el desarrollo embrionario, la respuesta a se√±ales ambientales y la homeostasis.",
                    tipos: "Nos dividimos en factores generales (requeridos para la iniciaci√≥n basal, ej. TFIID) y espec√≠ficos (que modulan finamente la expresi√≥n, ej. Oct4, MyoD).",
                    relacion_funcional: "Nos unimos a Promotores y Potenciadores para activar genes espec√≠ficos.  La Eucromatina facilita nuestro acceso. "
                },
                potenciadores: {
                    definici√≥n: "Somos secuencias reguladoras de ADN que aumentan la eficiencia de los promotores. ",
                    funci√≥n_principal: "Aumentamos la eficiencia de los Promotores. Podemos estar localizados a gran distancia del gen que regulamos. Actuamos independientemente de nuestra orientaci√≥n.",
                    relacion_funcional: "Interactuamos con Factores de transcripci√≥n para activar genes espec√≠ficos en tejidos concretos. "
                },
                silenciadores: {
                    definici√≥n: "Somos secuencias de ADN que reprimen la transcripci√≥n g√©nica. ",
                    funci√≥n_principal: "Reprimimos la expresi√≥n g√©nica. Al igual que los Potenciadores, podemos estar localizados a distancia.",
                    patolog√≠a: "Mutaciones en nosotros pueden llevar a expresi√≥n aberrante de genes, como en el c√°ncer. "
                },
                "metilaci√≥n del adn": { 
                    definici√≥n: "Soy una modificaci√≥n epigen√©tica que implica la adici√≥n de un grupo metilo al ADN, t√≠picamente en citosinas CpG, lo que usualmente inhibe la transcripci√≥n de genes. ",
                    funci√≥n_principal: "Generalmente, cuando me encuentro en regiones promotoras, estoy asociada con el silenciamiento g√©nico a largo plazo.",
                    relacion_funcional: "Controlo la accesibilidad del ADN a la transcripci√≥n junto con la Cromatina.  Errores en m√≠ se asocian con el S√≠ndrome de Rett. "
                },
                "arn nuclear (arnn)": { 
                    definici√≥n: "Soy el transcrito inicial de un gen que incluye intrones y exones. ",
                    funci√≥n_principal: "Contengo tanto secuencias codificantes (exones) como no codificantes (intrones). Debo ser procesado para convertirme en ARNm maduro.",
                    relacion_funcional: "El Empalme alternativo act√∫a sobre m√≠ para generar diversidad proteica. "
                },
                "empalme alternativo": {
                    definici√≥n: "Soy un proceso regulado que permite generar diferentes prote√≠nas (Isoformas de empalme) a partir de un solo gen, mediante la combinaci√≥n diferencial de exones del ARN nuclear. ",
                    funci√≥n_principal: "Aumento enormemente la capacidad codificante del genoma y la diversidad proteica.",
                    importancia: "Es un mecanismo clave para la regulaci√≥n g√©nica y la complejidad biol√≥gica.",
                    relacion_funcional: "Act√∫o sobre el ARN nuclear (ARNn) para producir diferentes Isoformas de empalme, generando diversidad proteica. "
                },
                "isoformas de empalme": {
                    definici√≥n: "Somos variantes de prote√≠nas generadas por empalme alternativo a partir de un solo gen. ",
                    funci√≥n_principal: "Aunque provenimos del mismo gen, podemos tener funciones diferentes debido a la inclusi√≥n o exclusi√≥n de ciertos exones.",
                    relacion_funcional: "Somos el resultado del Empalme alternativo del ARN nuclear." //
                },
                inducci√≥n: {
                    definici√≥n: "Soy un proceso por el cual un tejido (inductor) determina el destino de desarrollo de otro tejido adyacente (respondedor). ",
                    funci√≥n_principal: "Dirijo la diferenciaci√≥n celular y la morfog√©nesis.",
                    relacion_funcional: "Para que yo ocurra, el tejido respondedor debe tener Competencia.  Las Interacciones epitelio-mes√©nquima son un ejemplo cl√°sico de m√≠. "
                },
                competencia: {
                    definici√≥n: "Soy la capacidad de una c√©lula o tejido para responder a se√±ales inductivas espec√≠ficas. ",
                    funci√≥n_principal: "Aseguro que solo las c√©lulas correctas respondan a una se√±al inductiva particular.",
                    relacion_funcional: "Soy un requisito para que la Inducci√≥n sea efectiva. "
                },
                "interacciones epitelio-mes√©nquima": {
                    definici√≥n: "Somos un tipo fundamental de comunicaci√≥n inductiva entre una capa epitelial y el tejido mesenquimatoso subyacente que regula la organog√©nesis. ",
                    funci√≥n_principal: "Regulamos la morfog√©nesis y diferenciaci√≥n de numerosos √≥rganos como ri√±√≥n, pulm√≥n o h√≠gado. ",
                    patolog√≠a: "Fallos en nuestras interacciones pueden ser causados por terat√≥genos como la talidomida, llevando a Focomelia. "
                },
                "factores paracrinos": { 
                    definici√≥n: "Somos mol√©culas se√±alizadoras secretadas por una c√©lula que difunden y act√∫an sobre c√©lulas vecinas. ",
                    funci√≥n_principal: "Mediamos la comunicaci√≥n intercelular local, jugando roles cruciales en la Inducci√≥n y desarrollo.",
                    familias_principales: "Incluimos familias como FGF, Hedgehog (ej. V√≠a SHH), WNT (ej. V√≠a WNT), y TGF-Œ≤."
                },
                // V√≠as SHH, WNT, Notch ya tienen entradas m√°s detalladas con sus IDs 18, 19, 20.
                // Patolog√≠as Cap√≠tulo 1
                "s√≠ndrome de rett": { // ID 21
                    definici√≥n: "Soy un trastorno del neurodesarrollo gen√©tico que afecta principalmente a ni√±as, causado por mutaciones en el gen MECP2, relacionado con la Metilaci√≥n del ADN. ",
                    causa: "Mutaciones en MECP2, una prote√≠na que lee marcas de Metilaci√≥n del ADN y regula la transcripci√≥n.",
                    caracter√≠sticas: "Desarrollo inicial normal seguido de regresi√≥n de habilidades, movimientos manuales estereotipados, problemas respiratorios."
                },
                "s√≠ndrome de prader-willi": { // ID 22
                    definici√≥n: "Soy un trastorno gen√©tico causado por un error en la impronta gen√©tica del cromosoma 15 paterno. ",
                    causa: "P√©rdida de expresi√≥n de genes paternos en 15q11-q13.",
                    caracter√≠sticas: "Hipoton√≠a neonatal, hiperfagia con obesidad, discapacidad intelectual leve."
                },
                "s√≠ndrome de angelman": { // ID 23
                    definici√≥n: "Soy un trastorno neurogen√©tico causado por un error en la impronta gen√©tica del cromosoma 15 materno (gen UBE3A). ",
                    causa: "P√©rdida de funci√≥n de UBE3A materno en 15q11-q13.",
                    caracter√≠sticas: "Retraso severo del desarrollo, ausencia de habla, ataxia, risa frecuente."
                },
                "c√°ncer (regulaci√≥n g√©nica)": { // ID 24
                    definici√≥n: "El c√°ncer puede surgir por la expresi√≥n aberrante de genes debido a mutaciones en Promotores o Silenciadores, afectando el control del ciclo celular y la proliferaci√≥n. ",
                    causa: "Mutaciones en secuencias reguladoras (Promotores, Silenciadores, Potenciadores) o en Factores de transcripci√≥n.",
                    consecuencias: "Proliferaci√≥n celular descontrolada y formaci√≥n de tumores."
                },
                "s√≠ndrome de alagille": { // ID 25
                    definici√≥n: "Soy un trastorno gen√©tico multisist√©mico causado por mutaciones en la V√≠a Notch (genes JAG1 o NOTCH2), afectando √≥rganos como el coraz√≥n y el h√≠gado. ",
                    causa: "Mutaciones en JAGGED1 o NOTCH2, componentes de la V√≠a Notch.",
                    caracter√≠sticas: "Escasez de conductos biliares, cardiopat√≠as, facies caracter√≠stica."
                },
                holoprosencefalia: { // ID 26
                    definici√≥n: "Soy una malformaci√≥n cerebral compleja debida a una falla en la V√≠a SHH que impide la correcta divisi√≥n del prosenc√©falo (cerebro anterior). ",
                    causa: "Disfunci√≥n de la V√≠a SHH u otros genes relacionados (SIX3, ZIC2).",
                    caracter√≠sticas: "Desde ciclopia hasta defectos faciales menores, seg√∫n la severidad."
                },
                craneosinostosis: { // ID 27
                    definici√≥n: "Soy una condici√≥n causada por el cierre prematuro de una o m√°s suturas craneales, a menudo debido a mutaciones en receptores de factores de crecimiento de fibroblastos (FGFR), relacionados con se√±ales FGF. ",
                    causa: "Mutaciones en genes FGFR, que son parte de v√≠as de se√±alizaci√≥n mediadas por Factores paracrinos (FGFs).",
                    consecuencias: "Forma anormal del cr√°neo y posible afectaci√≥n del desarrollo cerebral."
                },
                "defectos del tubo neural": { // ID 28
                    definici√≥n: "Soy un grupo de malformaciones cong√©nitas del cerebro y la m√©dula espinal (ej. anencefalia, espina b√≠fida) que pueden ser causadas por mutaciones en la V√≠a WNT/PCP (Polaridad Celular Planar), alterando la convergencia y extensi√≥n celular durante el cierre del tubo neural. ",
                    causa: "Factores gen√©ticos (incluyendo mutaciones en la V√≠a WNT/PCP) y ambientales (deficiencia de √°cido f√≥lico).",
                    importancia: "Son malformaciones graves del sistema nervioso central."
                },
                "focomelia por talidomida": { // ID 29
                    definici√≥n: "Soy una malformaci√≥n severa de las extremidades (miembros cortos o ausentes) causada por la exposici√≥n prenatal al f√°rmaco talidomida. Se debe a una falla en las Interacciones epitelio-mes√©nquima cruciales para el desarrollo de las extremidades. ",
                    causa: "Efecto teratog√©nico de la talidomida sobre las Interacciones epitelio-mes√©nquima.",
                    importancia_hist√≥rica: "Un tr√°gico ejemplo de los efectos de los terat√≥genos durante el desarrollo."
                },
                "s√≠ndrome de holt-oram": { // ID 30
                    definici√≥n: "Soy un trastorno gen√©tico autos√≥mico dominante caracterizado por malformaciones de las extremidades superiores (especialmente radiales) y defectos card√≠acos cong√©nitos, debido a alteraciones en genes de se√±alizaci√≥n como TBX5 (un Factor de transcripci√≥n). ",
                    causa: "Mutaciones en el gen TBX5, un Factor de transcripci√≥n crucial para el desarrollo del coraz√≥n y las extremidades.",
                    caracter√≠sticas: "Anomal√≠as en pulgares, radio, y defectos card√≠acos como comunicaci√≥n interauricular o interventricular."
                },

                // CAP√çTULO 2
                "c√©lulas germinales primordiales": { // ID 31
                    definici√≥n: "Somos c√©lulas precursoras de los gametos que migran desde el Epiblasto, pasando por el Saco vitelino en la semana 2, hasta las G√≥nadas en desarrollo en la semana 5. ",
                    funci√≥n_principal: "Damos origen a los √≥vulos y espermatozoides.",
                    semana_aparicion: "Semana 2 (origen en epiblasto), migraci√≥n hasta semana 5.",
                    relacion_con: "Epiblasto, Saco vitelino, G√≥nadas en desarrollo.",
                    relacion_funcional: "Derivamos del Epiblasto y migramos a la g√≥nada.  Errores en nuestra migraci√≥n pueden causar Teratomas. "
                },
                epiblasto: { // ID 32
                    definici√≥n: "Soy la capa superior del disco embrionario bilaminar durante la segunda semana. Tambi√©n origino todas las capas germinales (ectodermo, mesodermo, endodermo) y las C√©lulas Germinales Primordiales (CGP). ",
                    funci√≥n_principal: "Soy la fuente de todas las c√©lulas del embri√≥n y de las CGP.  En la tercera semana, mis c√©lulas migran a trav√©s de la Estr√≠a primitiva. ",
                    semana_aparicion: "Segunda semana (como parte del disco bilaminar). ",
                    relacion_con: "Disco bilaminar, Hipoblasto, Estr√≠a primitiva , Cavidad amni√≥tica, Amnioblastos.",
                    objetivo_busqueda: "Busco formar el ectodermo, mesodermo y endodermo, as√≠ como las CGP. ",
                    relacion_funcional: "Las C√©lulas Germinales Primordiales derivan de m√≠.  Formo la base de la Cavidad amni√≥tica.  Los Amnioblastos derivan de m√≠. "
                },
                "estr√≠a primitiva": { // ID 33
                    definici√≥n: "Soy un engrosamiento celular transitorio en la l√≠nea media de la superficie dorsal del Epiblasto del embri√≥n, visible al inicio de la tercera semana (Cap√≠tulo 5) pero mi formaci√≥n se inicia en la segunda semana tard√≠a (Cap√≠tulo 2). Soy el punto de inicio de la gastrulaci√≥n. ",
                    funci√≥n_principal: "Permito la migraci√≥n (invaginaci√≥n) de c√©lulas del epiblasto hacia el interior del embri√≥n para formar las tres capas germinativas: Endodermo embrionario y Mesodermo embrionario. Las c√©lulas del epiblasto que no migran forman el Ectodermo embrionario. ",
                    semana_aparicion: "Finales de la segunda e inicio de la tercera semana. ",
                    relacion_con: "Epiblasto (me formo en √©l) , Nodo primitivo (en mi extremo cef√°lico) , Mesodermo, Endodermo, Ectodermo.",
                    objetivo_busqueda: "Busco organizar la gastrulaci√≥n y formar las tres capas germinativas. ",
                    relacion_funcional: "Permito la migraci√≥n de c√©lulas del Epiblasto para formar el Mesodermo y el Endodermo.  El Nodo primitivo se encuentra en mi extremo craneal. Remanentes m√≠os pueden dar lugar a Teratomas sacrococc√≠geos. "
                },
                "saco vitelino": { // ID 34 (General, ver espec√≠ficos 93, 101, 103)
                    definici√≥n: "Soy un anexo embrionario. En la semana 2, las CGP migran hacia m√≠ antes de ir a las g√≥nadas.  En la semana 3, el Alantoides evagina de m√≠. ",
                    funci√≥n_principal: "Sirvo de sitio temporal para las CGP  y contribuyo a la nutrici√≥n temprana y hematopoyesis.",
                    semana_aparicion: "Desde la segunda semana (primario).",
                    relacion_con: "C√©lulas germinales primordiales, Hipoblasto, Alantoides.",
                    relacion_funcional: "El Hipoblasto forma el Saco vitelino primario.  El Alantoides es una evaginaci√≥n m√≠a. "
                },
                "g√≥nadas en desarrollo": { // ID 35
                    definici√≥n: "Somos los √≥rganos (futuros ovarios o test√≠culos) donde maduran las C√©lulas Germinales Primordiales (CGP) para convertirse en gametos. ",
                    funci√≥n_principal: "Albergar y permitir la maduraci√≥n de las CGP.",
                    semana_aparicion: "Las CGP llegan en la semana 5. ",
                    relacion_con: "C√©lulas germinales primordiales, Meiosis, Citodiferenciaci√≥n.",
                    patolog√≠a: "El Fallo gonadal prematuro , S√≠ndrome de Turner , S√≠ndrome de Klinefelter , S√≠ndrome de Swyer  y Disgenesia gonadal  nos afectan."
                },
                 // ... (Resto de perfiles de Cap 2 y sus patolog√≠as - IDs 36 a 60) ...
                // ... (Resto de perfiles de Cap 3 y sus patolog√≠as - IDs 61 a 88) ...
                // ... (Resto de perfiles de Cap 4 y sus patolog√≠as - IDs 89 a 110) ...
                // Cap√≠tulo 5 (Nuevos perfiles y actualizaciones) - IDs 111 a 138
                "nodo primitivo": { // ID 111
                    definici√≥n: "Soy una estructura engrosada localizada en el extremo cef√°lico de la Estr√≠a primitiva durante la tercera semana del desarrollo. ",
                    funci√≥n_principal: "Controlo la migraci√≥n y diferenciaci√≥n celular durante la gastrulaci√≥n y dirijo el desarrollo axial del embri√≥n.  Induzco la formaci√≥n de la Notocorda y otras estructuras mediales. ",
                    semana_aparicion: "Tercera semana. ",
                    relacion_con: "Estr√≠a primitiva, Notocorda, Fosa primitiva. ",
                    objetivo_busqueda: "Busco inducir la Notocorda y establecer el eje principal del cuerpo. ",
                    relacion_funcional: "Dirijo la formaci√≥n de la Notocorda.  Contengo la Fosa primitiva, por donde ingresan c√©lulas. Una duplicaci√≥n m√≠a puede causar duplicaci√≥n del eje embrionario. "
                },
                "fosa primitiva": { // ID 112
                    definici√≥n: "Soy una depresi√≥n o indentaci√≥n que se forma en el centro del Nodo primitivo durante la tercera semana. ",
                    funci√≥n_principal: "Sirvo como el sitio espec√≠fico por donde las c√©lulas del epiblasto se invaginan para formar el proceso notocordal y luego la Notocorda (mesodermo axial). Soy el inicio del canal notocordal. ",
                    semana_aparicion: "Tercera semana. ",
                    relacion_con: "Nodo primitivo (estoy dentro de √©l). ",
                    objetivo_busqueda: "Busco ser el punto de partida para la formaci√≥n de la Notocorda. ",
                    relacion_funcional: "Soy la entrada al Canal notocordal, dentro del Nodo primitivo."
                },
                "canal notocordal": { // ID 113
                    definici√≥n: "Soy un conducto o tubo celular temporal que se forma a partir de la invaginaci√≥n de c√©lulas a trav√©s de la Fosa primitiva del Nodo primitivo, extendi√©ndose cef√°licamente en la l√≠nea media. ",
                    funci√≥n_principal: "Mi funci√≥n es ser el precursor inmediato de la Notocorda definitiva. Tambi√©n dirijo la inducci√≥n del tubo neural. ",
                    semana_aparicion: "Tercera semana. ",
                    relacion_con: "Fosa primitiva (me origino de ella), Nodo primitivo. ",
                    objetivo_busqueda: "Busco transformarme en la Notocorda. ",
                    relacion_funcional: "Me formo desde la Fosa primitiva y me convierto en la Notocorda."
                },
                notocorda: { // ID 114
                    definici√≥n: "Soy un cilindro mesod√©rmico axial que act√∫a como eje estructural embrionario. ",
                    funci√≥n_principal: "Induzco la formaci√≥n del tubo neural a partir del ectodermo suprayacente y organizo la diferenciaci√≥n de los somitas. ",
                    semana_aparicion: "Tercera semana. ",
                    relacion_con: "Ectodermo, Somitas. ",
                    objetivo_busqueda: "Busco guiar el desarrollo axial. ",
                    relacion_funcional: "El Nodo primitivo dirige mi formaci√≥n.  Induzco al Ectodermo. Defectos en m√≠ pueden causar anomal√≠as axiales. "
                },
                "endodermo embrionario": { // ID 115
                    definici√≥n: "Soy la capa germinal m√°s interna del embri√≥n, derivada del epiblasto durante la gastrulaci√≥n en la tercera semana. ",
                    funci√≥n_principal: "Formar√© el revestimiento epitelial del tubo digestivo y gl√°ndulas asociadas (h√≠gado, p√°ncreas), el tracto respiratorio, la vejiga urinaria. ",
                    semana_aparicion: "Tercera semana. ",
                    relacion_con: "Epiblasto (mi origen), Mesodermo embrionario. ",
                    objetivo_busqueda: "Busco formar el intestino primitivo. ",
                    relacion_funcional: "Me formo a partir del Epiblasto durante la gastrulaci√≥n, mediada por la Estr√≠a primitiva."
                },
                "mesodermo embrionario": { // ID 116
                    definici√≥n: "Soy la capa germinal media, situada entre Ectodermo y Endodermo, originada del epiblasto durante la gastrulaci√≥n en la tercera semana. ",
                    funci√≥n_principal: "Dar√© origen a m√∫sculo, hueso, sangre, sistema urogenital, cardiovascular y m√°s. Permito la diferenciaci√≥n estructural y funcional. ",
                    semana_aparicion: "Tercera semana. ",
                    relacion_con: "Epiblasto (mi origen), Endodermo, Ectodermo. ",
                    objetivo_busqueda: "Busco formar somitas, vasos y m√∫sculos. ",
                    relacion_funcional: "La Estr√≠a primitiva permite mi migraci√≥n y formaci√≥n.  Me diferencio en Mesodermo paraxial, Intermedio y Lateral."
                },
                "ectodermo embrionario": { // ID 117
                    definici√≥n: "Soy la capa germinal m√°s externa del embri√≥n, derivada de las c√©lulas del epiblasto que no migran a trav√©s de la Estr√≠a primitiva durante la gastrulaci√≥n en la tercera semana. ",
                    funci√≥n_principal: "Formar√© la epidermis y sus anexos, el sistema nervioso central (enc√©falo, m√©dula espinal) y perif√©rico, y √≥rganos sensoriales. ",
                    semana_aparicion: "Tercera semana. ",
                    relacion_con: "Notocorda (me induce), Tubo neural (me formo en √©l). ",
                    objetivo_busqueda: "Busco formar la epidermis y el SNC. ",
                    relacion_funcional: "La Notocorda me induce para formar el Tubo neural. "
                },
                "placa precordal": { // ID 118
                    definici√≥n: "Soy un peque√±o grupo de c√©lulas mesod√©rmicas situadas entre el extremo cef√°lico de la Notocorda y la Membrana bucofar√≠ngea. ",
                    funci√≥n_principal: "Induzco al enc√©falo y gu√≠o el desarrollo cef√°lico. ",
                    semana_aparicion: "Tercera semana. ",
                    relacion_con: "Notocorda, enc√©falo en desarrollo, Membrana bucofar√≠ngea. ",
                    objetivo_busqueda: "Busco formar estructuras craneales. ",
                    relacion_funcional: "Soy un importante inductor para el desarrollo del prosenc√©falo."
                },
                "membrana bucofar√≠ngea": { // ID 119
                    definici√≥n: "Soy una estructura bilaminar (Ectodermo y Endodermo fusionados, sin Mesodermo) en la regi√≥n cef√°lica, que marca el sitio futuro de la boca. ",
                    funci√≥n_principal: "Delimito la regi√≥n cef√°lica anterior y separo el estomodeo (boca primitiva) de la faringe.  Me romper√© para comunicar la cavidad oral y la faringe.",
                    semana_aparicion: "Tercera semana. ",
                    relacion_con: "Placa precordal, faringe. ",
                    objetivo_busqueda: "Busco abrir paso al estomodeo. ",
                    relacion_funcional: "Ser√© el sitio de la futura boca (Estomodeo). "
                },
                "membrana cloacal": { // ID 120
                    definici√≥n: "Soy una estructura bilaminar (Ectodermo y Endodermo fusionados, sin Mesodermo) en la regi√≥n caudal del embri√≥n. ",
                    funci√≥n_principal: "Marco el sitio futuro del ano y aberturas urogenitales. Soy un cierre temporal de la regi√≥n anal. ",
                    semana_aparicion: "Tercera semana. ",
                    relacion_con: "Mesodermo caudal, intestino posterior (cloaca). ",
                    objetivo_busqueda: "Busco abrir el ano embrionario y las salidas urogenitales. ",
                    relacion_funcional: "Ser√© el sitio del futuro ano.  Su persistencia o ruptura an√≥mala causa Anomal√≠as cloacales. "
                },
                alantoides: { // ID 121
                    definici√≥n: "Soy una peque√±a evaginaci√≥n del endodermo del Saco vitelino que se extiende hacia el interior del Ped√≠culo de fijaci√≥n durante la tercera semana. ",
                    funci√≥n_principal: "Aunque rudimentario en humanos, participo en la formaci√≥n del cord√≥n umbilical y la vejiga. Mis vasos sangu√≠neos se convierten en los vasos umbilicales. Mi porci√≥n proximal forma el uraco. ",
                    semana_aparicion: "Tercera semana. ",
                    relacion_con: "Ped√≠culo de fijaci√≥n, Saco vitelino. ",
                    objetivo_busqueda: "Busco contribuir al desarrollo urinario y formar los vasos umbilicales. ",
                    relacion_funcional: "Participo en la formaci√≥n del Cord√≥n umbilical.  La persistencia de mi luz puede dar lugar a una F√≠stula alantoidea (uracal). "
                },
                "mesodermo paraxial": { // ID 122
                    definici√≥n: "Soy la regi√≥n del Mesodermo embrionario que se organiza en columnas longitudinales a cada lado de la Notocorda. ",
                    funci√≥n_principal: "Me segmento craneocaudalmente para formar los Somitas, que dar√°n origen al esqueleto axial (v√©rtebras, costillas), la musculatura esquel√©tica y la dermis dorsal. Proporciono soporte y segmentaci√≥n axial. ",
                    semana_aparicion: "Tercera semana. ",
                    relacion_con: "Notocorda, Somitas. ",
                    objetivo_busqueda: "Busco formar el esqueleto axial. ",
                    relacion_funcional: "Me segmento para formar los Somitas.  Mi hipoplasia puede causar problemas de desarrollo √≥seo-muscular. "
                },
                "mesodermo intermedio": { // ID 123
                    definici√≥n: "Soy una estrecha banda de Mesodermo embrionario que conecta el Mesodermo paraxial con el Mesodermo lateral. Formo estructuras urogenitales. ",
                    funci√≥n_principal: "Me diferencio para formar la mayor parte del sistema urogenital, incluyendo ri√±ones y g√≥nadas (aunque las CGP tienen otro origen). ",
                    semana_aparicion: "Tercera semana. ",
                    relacion_con: "Mesodermo lateral, Somitas. ",
                    objetivo_busqueda: "Busco formar el sistema urinario. ",
                    relacion_funcional: "Conecto el Mesodermo paraxial con el Lateral. Doy origen a estructuras urogenitales."
                },
                "mesodermo lateral": { // ID 124
                    definici√≥n: "Soy la porci√≥n m√°s lateral del Mesodermo embrionario. Me divido en dos hojas (Somatopleura y Esplacnopleura) que delimitan el celoma intraembrionario (futuras cavidades corporales). ",
                    funci√≥n_principal: "La Somatopleura forma la dermis de la pared corporal, huesos de extremidades y revestimiento parietal de cavidades. La Esplacnopleura forma el m√∫sculo liso del tubo digestivo, coraz√≥n y revestimiento visceral. ",
                    semana_aparicion: "Tercera semana. ",
                    relacion_con: "Mesodermo intermedio, Somatopleura, Esplacnopleura. ",
                    objetivo_busqueda: "Busco formar las cavidades corporales, serosas y mesenterios. ",
                    relacion_funcional: "Me divido para formar Somatopleura y Esplacnopleura, delimitando las futuras cavidades corporales.  Defectos en m√≠ pueden causar malformaciones card√≠acas o de las cavidades. "
                },
                somatopleura: { // ID 125
                    definici√≥n: "Soy una de las dos capas del Mesodermo lateral, formada por la asociaci√≥n de su hoja parietal con el Ectodermo suprayacente. ",
                    funci√≥n_principal: "Contribuyo a la formaci√≥n de la pared corporal lateral y ventral, incluyendo la dermis, huesos de extremidades y el revestimiento parietal de las cavidades corporales. Proporciono soporte som√°tico. ",
                    semana_aparicion: "Tercera semana. ",
                    relacion_con: "Mesodermo lateral (soy su parte parietal), Ectodermo. ",
                    objetivo_busqueda: "Busco formar la pared corporal. ",
                    relacion_funcional: "Derivo del Mesodermo lateral y junto con el ectodermo formo la pared del cuerpo."
                },
                esplacnopleura: { // ID 126
                    definici√≥n: "Soy una de las dos capas del Mesodermo lateral, formada por la asociaci√≥n de su hoja visceral con el Endodermo subyacente. ",
                    funci√≥n_principal: "Doy origen al m√∫sculo liso, tejido conectivo y vasos del tubo digestivo, as√≠ como al coraz√≥n, revestimiento visceral de cavidades y mesenterios. Proporciono soporte visceral. ",
                    semana_aparicion: "Tercera semana. ",
                    relacion_con: "Mesodermo lateral (soy su parte visceral), Endodermo, Intestino. ",
                    objetivo_busqueda: "Busco formar el intestino y los vasos mesent√©ricos. ",
                    relacion_funcional: "Derivo del Mesodermo lateral y junto con el endodermo formo la pared del tubo digestivo."
                },
                somitas: { // ID 127
                    definici√≥n: "Somos bloques segmentados de Mesodermo paraxial que nos formamos a ambos lados del Tubo neural y la Notocorda. ",
                    funci√≥n_principal: "Damos origen al esqueleto axial (v√©rtebras, costillas), la musculatura esquel√©tica del tronco y extremidades, y la dermis dorsal. Establecemos la segmentaci√≥n axial. ",
                    semana_aparicion: "Finales de la tercera semana. ",
                    relacion_con: "Notocorda, Mesodermo paraxial. ",
                    objetivo_busqueda: "Buscamos formar la columna y la musculatura. ",
                    relacion_funcional: "El Mesodermo paraxial se segmenta para formarnos.  La agenesia de nosotros causa falta de formaci√≥n vertebral. "
                },
                "canal neurent√©rico": { // ID 128
                    definici√≥n: "Soy una comunicaci√≥n o conducto temporal y transitorio entre la cavidad amni√≥tica y el saco vitelino, a trav√©s de la fosa primitiva. ",
                    funci√≥n_principal: "Mi funci√≥n es temporal en el desarrollo axial, permitiendo el paso de l√≠quido entre cavidades. ",
                    semana_aparicion: "Tercera semana (muy transitorio). ",
                    relacion_con: "Notocorda, Tubo neural, Cavidad amni√≥tica, Saco vitelino. ",
                    objetivo_busqueda: "Busco desaparecer luego. ",
                    relacion_funcional: "Conecto temporalmente la cavidad amni√≥tica y el saco vitelino."
                },
                // L√≠nea Primitiva (alias de Estr√≠a Primitiva ID 33)
                // Patolog√≠as Cap√≠tulo 5
                "teratomas sacrococc√≠geos": { // ID 129
                    definici√≥n: "Soy un tipo de Teratoma que se localiza en la regi√≥n sacrococc√≠gea, originado de remanentes de la Estr√≠a primitiva. ",
                    causa: "Persistencia de c√©lulas pluripotentes de la Estr√≠a primitiva.",
                    caracter√≠sticas: "Tumor cong√©nito com√∫n en reci√©n nacidos, puede ser benigno o maligno.",
                    relacion_funcional: "Es un Teratoma (ver ID 51) espec√≠fico, relacionado con la Estr√≠a primitiva."
                },
                "gastrulaci√≥n incompleta": { // ID 130
                    definici√≥n: "Soy una falla en la correcta formaci√≥n o migraci√≥n de c√©lulas a trav√©s de la Estr√≠a primitiva, resultando en deficiente formaci√≥n de capas germinativas. ",
                    causa: "Defectos en la Estr√≠a primitiva o se√±alizaci√≥n an√≥mala.",
                    consecuencias: "Malformaciones cong√©nitas severas, a menudo incompatibles con la vida.",
                    relacion_funcional: "Fallo en gastrulaci√≥n, afectando Endodermo, Mesodermo y Ectodermo."
                },
                "defectos de notocorda": { // ID 131
                    definici√≥n: "Soy un grupo de anomal√≠as por formaci√≥n, estructura o funci√≥n defectuosa de la Notocorda. ",
                    causa: "Factores gen√©ticos o teratog√©nicos afectando el Nodo primitivo o Canal notocordal.",
                    consecuencias: "Malformaciones del eje axial (columna) y defectos en inducci√≥n del SNC.",
                    relacion_funcional: "Problemas en la Notocorda afectan inducci√≥n del Ectodermo y organizaci√≥n de Somitas."
                },
                "situs inversus": { // ID 132
                    definici√≥n: "Soy una condici√≥n con √≥rganos internos en disposici√≥n en espejo. Relacionada con alteraciones en cilios del Nodo primitivo. ",
                    causa: "Alteraciones en el establecimiento de la lateralidad izquierda-derecha durante la gastrulaci√≥n (funci√≥n ciliar del Nodo primitivo).",
                    tipos: "Totalis (todos los √≥rganos) o partialis. Puede asociarse con s√≠ndrome de Kartagener.",
                    relacion_funcional: "Anomal√≠a en la funci√≥n del Nodo primitivo."
                },
                "agenesia de somitas": { // ID 133
                    definici√≥n: "Ausencia de formaci√≥n de uno o m√°s Somitas. ",
                    causa: "Defectos en Mesodermo paraxial o se√±ales inductivas de Notocorda/Tubo neural.",
                    consecuencias: "Falta de desarrollo de v√©rtebras, costillas o m√∫sculos segmentarios.",
                    relacion_funcional: "Falla en formaci√≥n de Somitas a partir del Mesodermo paraxial."
                },
                "defectos del mesodermo lateral": { // ID 134
                    definici√≥n: "Malformaciones por desarrollo anormal del Mesodermo lateral. ",
                    causa: "Problemas en especificaci√≥n, migraci√≥n o diferenciaci√≥n del mesodermo lateral.",
                    consecuencias: "Cardiopat√≠as cong√©nitas, malformaciones de pared corporal ventral (onfalocele), defectos de extremidades.",
                    relacion_funcional: "Problemas en Mesodermo lateral y sus derivados (Somatopleura, Esplacnopleura)."
                },
                "anomal√≠as cloacales": { // ID 135
                    definici√≥n: "Defectos en desarrollo de la cloaca o persistencia de Membrana cloacal. ",
                    causa: "Fallos en la divisi√≥n de la cloaca por el septo urorrectal o problemas con la Membrana cloacal.",
                    consecuencias: "Malformaciones anorrectales y urogenitales complejas.",
                    relacion_funcional: "Defectos de la Membrana cloacal y la cloaca."
                },
                "f√≠stula alantoidea (uracal)": { // ID 136
                    definici√≥n: "Persistencia del uraco (remanente del Alantoides) que conecta vejiga fetal con ombligo. ",
                    tipos: "F√≠stula completa (drenaje de orina por ombligo), quiste uracal, seno uracal.",
                    consecuencias: "Drenaje umbilical, infecciones.",
                    relacion_funcional: "Persistencia an√≥mala del Alantoides."
                },
                "duplicaci√≥n del nodo primitivo": { // ID 137
                    definici√≥n: "Anomal√≠a rara con formaci√≥n de dos Nodos primitivos. ",
                    causa: "Alteraci√≥n en mecanismos que establecen un √∫nico centro organizador.",
                    consecuencias: "Formaci√≥n de dos ejes embrionarios, duplicaci√≥n de estructuras axiales, gemelos siameses.",
                    relacion_funcional: "Duplicaci√≥n del Nodo primitivo y Estr√≠a primitiva."
                },
                "mesodermo paraxial hipopl√°sico": { // ID 138
                    definici√≥n: "Desarrollo reducido del Mesodermo paraxial. ",
                    causa: "Producci√≥n deficiente de c√©lulas del mesodermo paraxial o problemas en su proliferaci√≥n.",
                    consecuencias: "Formaci√≥n deficiente de Somitas, anomal√≠as del esqueleto axial y musculatura.",
                    relacion_funcional: "Defecto en desarrollo del Mesodermo paraxial, afectando Somitas."
                }
            };


            const profileKey = profile.name.toLowerCase();
            const profileKnowledge = knowledgeBase[profileKey];

            const intents = {
                funci√≥n: ["funci√≥n", "funciona", "sirve", "hace", "papel", "rol", "trabajo", "objetivo", "proposito", "funci√≥n principal"],
                definici√≥n: ["qu√© eres", "que eres", "define", "definici√≥n", "describete", "descripcion", "quien eres"],
                estructura: ["estructura", "compuesto", "formado", "partes", "componentes", "organizaci√≥n", "c√≥mo soy", "constitucion"],
                importancia: ["importante", "importancia", "crucial", "esencial", "necesario", "vital", "relevancia", "significado"],
                relaci√≥n: ["relaciona", "interact√∫a", "conecta", "trabaja con", "vincula", "asocia", "colabora", "nexo", "relacion funcional", "relaci√≥n con"],
                desarrollo: ["desarrollo", "embriolog√≠a", "formaci√≥n", "diferenciaci√≥n", "embri√≥n", "ontogenia", "c√≥mo me formo", "origen embrionario", "proceso siguiente", "evoluci√≥n"],
                patolog√≠a: ["enfermedad", "patolog√≠a", "s√≠ndrome asociado", "trastorno", "alteraci√≥n", "problema", "defecto", "qu√© pasa si fallo", "anomalia"],
                mecanismo: ["mecanismo", "c√≥mo funciona", "proceso de", "v√≠a de", "cascada", "se√±alizaci√≥n", "operaci√≥n", "funcionamiento"], 
                s√≠ntomas: ["s√≠ntomas", "caracter√≠sticas cl√≠nicas", "signos", "manifestaciones", "presenta", "cuadro cl√≠nico", "indicios"],
                causa: ["causa", "origen", "por qu√© ocurre", "raz√≥n", "etiolog√≠a", "provoca", "genera", "motivo"],
                tratamiento: ["tratamiento", "cura", "terapia", "manejo", "medicamento", "tratar", "soluci√≥n", "remedio", "abordaje"],
                tipos: ["tipos", "clases", "variedades", "formas", "clasificaci√≥n", "divisiones"],
                genes: ["genes implicados", "gen√©tica", "adn", "mutaci√≥n", "alelo", "cromosoma"],
                migracion: ["migraci√≥n", "d√≥nde vas", "recorrido", "viaje", "movimiento"], 
                etapas: ["etapas", "fases", "pasos", "proceso clave"], 
                localizaci√≥n: ["d√≥nde est√°s", "ubicaci√≥n", "localizaci√≥n", "donde ocurre", "donde te encuentras"],
                semana_aparicion: ["cu√°ndo apareces", "en qu√© semana", "semana de aparici√≥n", "momento de aparici√≥n", "cu√°ndo te formas"],
                objetivo_busqueda: ["qu√© buscas", "cu√°l es tu meta", "objetivo", "prop√≥sito final", "meta", "qu√© quieres lograr"],
                gametog√©nesis_afectada: ["c√≥mo afecta gametog√©nesis", "problema gametos", "efecto en gametos"],
                consecuencias: ["consecuencias", "qu√© pasa despu√©s", "resultado", "efecto", "qu√© resulta"],
                general: ["dime m√°s", "explica", "cu√©ntame", "informaci√≥n", "detalles", "general", "resumen", "idea principal", "sal√∫dame", "qu√© tal", "otro dato"]
            };

            let detectedIntent = null;
            let bestMatchScore = 0;
            let matchedKeywordForIntent = "";

            for (const [intent, keywords] of Object.entries(intents)) {
                for (const keyword of keywords) {
                    if (message.includes(keyword)) {
                        let currentScore = keyword.length; 
                        if (keywords[0] === keyword) { 
                           currentScore += keywords[0].length * 0.5;
                        }
                        if (currentScore > bestMatchScore) {
                            bestMatchScore = currentScore;
                            detectedIntent = intent;
                            matchedKeywordForIntent = keyword; 
                        }
                    }
                }
            }
            
            if ((message.includes("hola") || message.includes("hi") || message.includes("saludos") || message.includes("qu√© tal")) && (bestMatchScore < 3 || detectedIntent === "general")) {
                const specificGreeting = profileKnowledge?.definici√≥n ? `Soy ${profile.name}. ${profileKnowledge.definici√≥n.split('.')[0] + '.'}` : `Soy ${profile.name}. ${profile.description.split('.')[0] + '.'}`;
                return `¬°Hola! ${specificGreeting} ¬øSobre qu√© aspecto espec√≠fico te gustar√≠a que conversemos hoy? (ej. mi funci√≥n, importancia, relaci√≥n con otros, semana de aparici√≥n, etc.)`;
            }

            if (profileKnowledge && detectedIntent && profileKnowledge[detectedIntent]) {
                const intentKeyToUse = (detectedIntent === "relaci√≥n" && profileKnowledge.relacion_funcional) ? "relacion_funcional" : detectedIntent;
                return `Respecto a mi ${intentKeyToUse.replace(/_/g, " ")}, te comento: ${profileKnowledge[intentKeyToUse]}`;
            }
             if (profileKnowledge && detectedIntent === "relaci√≥n" && profileKnowledge.relacion_funcional) { 
                return `En cuanto a mi relaci√≥n funcional: ${profileKnowledge.relacion_funcional}`;
            }
            
            if (profileKnowledge && (detectedIntent === "general" || (bestMatchScore < 2 && detectedIntent))) { 
                 let summary = `Soy ${profile.name}. ${profileKnowledge?.definici√≥n ? profileKnowledge.definici√≥n.split('.')[0] + '.' : profile.description.split('.')[0] + '.'}`;
                const KbaseKeys = Object.keys(profileKnowledge);
                const availableAspects = KbaseKeys.filter(k => k !== 'definici√≥n' && profileKnowledge[k] && typeof profileKnowledge[k] === 'string'); 
                if(availableAspects.length > 0){
                    const suggestions = availableAspects.sort(() => 0.5 - Math.random()).slice(0, 2).map(s => s.replace(/_/g, " ")).join(' o mi '); 
                    summary += ` Podr√≠amos hablar sobre mi ${suggestions}, si te parece.`;
                } else {
                    summary += ` Preg√∫ntame cualquier otra cosa que te interese.`;
                }
                return summary;
            }
            
            if (profileKnowledge && detectedIntent && bestMatchScore > 0) {
                let fallbackResponse = `No tengo un dato espec√≠fico sobre "${matchedKeywordForIntent}" o "${detectedIntent.replace(/_/g, " ")}" para ${profile.name}. `;
                const availableData = Object.keys(profileKnowledge).filter(k => k !== 'definici√≥n' && k !== detectedIntent && profileKnowledge[k] && typeof profileKnowledge[k] === 'string');
                if (availableData.length > 0) {
                    const randomAspect = availableData[Math.floor(Math.random() * availableData.length)];
                    fallbackResponse += `Pero, ¬øte interesar√≠a saber sobre mi ${randomAspect.replace(/_/g, " ")}? Te cuento: ${profileKnowledge[randomAspect]}.`;
                } else {
                    fallbackResponse += `Te puedo dar mi descripci√≥n general: ${profileKnowledge.definici√≥n || profile.description}.`;
                }
                return fallbackResponse;
            }

            if (profile.keywords) {
                for (const keyword of profile.keywords) {
                    if (message.includes(keyword.toLowerCase())) {
                        return `¬°Interesante que menciones "${keyword}"! En mi contexto como ${profile.name}, "${keyword}" es relevante. Por ejemplo, ${profileKnowledge?.definici√≥n ? profileKnowledge.definici√≥n.split('.')[0] + '.' : profile.description.split('.')[0] + '.'} ¬øQuieres que profundice en c√≥mo me relaciono con "${keyword}" o quiz√°s mi funci√≥n general?`;
                    }
                }
            }

            if (message.includes("gracias") || message.includes("thanks")) {
                return `¬°De nada! Ha sido un placer ayudarte a entender m√°s sobre ${profile.name}. ¬øHay algo m√°s en lo que pueda ayudarte, quiz√°s sobre mi ${profileKnowledge?.relacion_funcional ? 'relaci√≥n funcional' : (profileKnowledge?.importancia ? 'importancia' : 'estructura')}?`;
            }
            if (message.includes("adi√≥s") || message.includes("chao") || message.includes("hasta luego")) {
                return `¬°Entendido! Ha sido un placer charlar sobre ${profile.name}. ¬°Sigue explorando el fascinante mundo de la embriolog√≠a! Hasta pronto.`;
            }

            const educationalResponses = [
                `Sobre tu consulta de ${profile.name}, puedo decirte que ${profileKnowledge?.definici√≥n ? profileKnowledge.definici√≥n.split('.')[0] + '.' : profile.description.split('.')[0] + '.'}. Este es un punto clave en el ${profile.chapter}. ¬øTe gustar√≠a saber m√°s sobre mi ${profileKnowledge?.funci√≥n_principal ? 'funci√≥n principal' : (profileKnowledge?.causa ? 'causa' : 'estructura')} o alguna patolog√≠a asociada si es el caso?`,
                `Me alegra tu inter√©s en ${profile.name}. Como ${profile.type}, soy de importancia ${profile.importance.toLowerCase()} porque ${profileKnowledge?.importancia || profile.description.split('.')[0] + '.'}. ¬øTe interesa profundizar en mi ${profileKnowledge?.mecanismo ? 'mecanismo' : (profileKnowledge?.desarrollo ? 'desarrollo' : 'relaci√≥n con otras estructuras')}?`,
                `¬°Excelente pregunta acerca de ${profile.name}! En el desarrollo embrionario, juego un papel crucial. ${profileKnowledge?.definici√≥n ? profileKnowledge.definici√≥n.split('.')[0] + '.' : profile.description.split('.')[0] + '.'}. ¬øTe gustar√≠a que exploremos mi ${profileKnowledge?.relacion_funcional ? 'relaci√≥n funcional' : (profileKnowledge?.estructura ? 'estructura' : 'importancia')} m√°s a fondo?`
            ];
            return educationalResponses[Math.floor(Math.random() * educationalResponses.length)];
        }

        function sendMessage() {
            const input = document.getElementById('message-input');
            const text = input.value.trim();
            
            if (!text || !currentChatProfile || isTyping) return;
            
            if (!chatMessages[currentChatProfile.id]) chatMessages[currentChatProfile.id] = []; 
            chatMessages[currentChatProfile.id].push({ sender: 'user', text: text });
            input.value = '';
            loadChatMessages(); 
            
            showTypingIndicator();
            
            setTimeout(() => {
                const aiResponse = generateAIResponse(text, currentChatProfile);
                 if (!chatMessages[currentChatProfile.id]) chatMessages[currentChatProfile.id] = [];
                chatMessages[currentChatProfile.id].push({ sender: 'ai', text: aiResponse });
                hideTypingIndicator();
                loadChatMessages();
            }, 1000 + Math.random() * 1000); 
        }

        function showTypingIndicator() {
            isTyping = true;
            loadChatMessages(); 
        }

        function hideTypingIndicator() {
            isTyping = false;
        }

        function switchTab(tabName, clickedButton) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(btn => btn.classList.remove('active'));
            
            const activeTabContent = document.getElementById(tabName);
            if (activeTabContent) activeTabContent.classList.add('active');
            
            if (clickedButton) {
                clickedButton.classList.add('active');
            } else { 
                 const targetTabButton = Array.from(document.querySelectorAll('.nav-tab')).find(btn => 
                    btn.textContent.toLowerCase() === tabName.toLowerCase() || 
                    (tabName === 'swipe' && btn.textContent.toLowerCase() === 'descubrir')
                 );
                 if(targetTabButton) targetTabButton.classList.add('active');
            }

            if (tabName === 'chat' && !currentChatProfile) {
                const chatMessagesContainer = document.getElementById('chat-messages');
                const emptyStateChat = chatMessagesContainer.querySelector('.empty-state');
                if (!emptyStateChat) {
                    chatMessagesContainer.innerHTML = '<div class="empty-state"><h3>Selecciona un match</h3><p>Elige un match para empezar a chatear</p></div>';
                } else {
                   if(emptyStateChat) emptyStateChat.style.display = 'flex';
                }
                const chatHeader = document.getElementById('chat-header');
                const chatInput = document.getElementById('chat-input');
                if(chatHeader) chatHeader.style.display = 'none';
                if(chatInput) chatInput.style.display = 'none';

            } else if (tabName === 'matches') {
                loadMatches(); 
            } else if (tabName === 'swipe') {
                if(currentCardIndex >= profiles.length && emptySwipeState) { 
                    emptySwipeState.style.display = 'flex';
                } else if (emptySwipeState) {
                     emptySwipeState.style.display = 'none';
                }
                updateActionButtonsState();
            }
        }

        function closeMatchPopup() {
            document.getElementById('match-popup').style.display = 'none';
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>